<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QuickMart POS - Self-Service Point of Sale</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f0f0; color: #333; }
    
    :root {
      --primary: #1a1a2e;
      --secondary: #16213e;
      --accent: #0f3460;
      --light: #e8e8e8;
      --white: #ffffff;
      --success: #2d5a27;
      --warning: #8b6914;
      --danger: #8b1414;
    }

    /* LOGO */
    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .logo-icon {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #ffffff 0%, #e0e0e0 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .logo-icon svg { width: 30px; height: 30px; }
    .logo-text { font-size: 28px; font-weight: 700; color: #fff; letter-spacing: -1px; }
    .logo-text span { font-weight: 300; opacity: 0.8; }

    /* WELCOME SCREEN */
    .welcome-screen {
      min-height: 100vh;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #fff;
      text-align: center;
      padding: 40px;
    }
    .welcome-logo { margin-bottom: 20px; }
    .welcome-logo .logo-icon { width: 80px; height: 80px; margin: 0 auto 15px; }
    .welcome-logo .logo-icon svg { width: 50px; height: 50px; }
    .welcome-logo h1 { font-size: 52px; font-weight: 700; margin-bottom: 5px; }
    .welcome-logo h1 span { font-weight: 300; opacity: 0.7; }
    .welcome-subtitle { font-size: 18px; color: rgba(255,255,255,0.7); margin-bottom: 60px; }
    
    .welcome-options { display: flex; gap: 25px; flex-wrap: wrap; justify-content: center; max-width: 1000px; }
    .welcome-option {
      background: rgba(255,255,255,0.95);
      color: #333;
      padding: 35px 40px;
      width: 300px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      text-align: center;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    .welcome-option:hover { transform: translateY(-8px); box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
    .welcome-option .icon { font-size: 48px; margin-bottom: 15px; }
    .welcome-option h2 { font-size: 22px; margin-bottom: 10px; color: var(--primary); }
    .welcome-option p { color: #666; font-size: 14px; line-height: 1.5; }

    .welcome-footer { margin-top: 60px; color: rgba(255,255,255,0.5); font-size: 14px; }
    .welcome-footer .currency { background: rgba(255,255,255,0.1); padding: 8px 20px; border-radius: 20px; display: inline-block; margin-top: 15px; }

    /* MODAL */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .modal-overlay.active { display: flex; }
    .modal-box {
      background: #fff;
      padding: 40px;
      width: 420px;
      max-width: 95%;
      border-radius: 20px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.3);
    }
    .modal-box h2 { margin-bottom: 25px; text-align: center; font-size: 24px; color: var(--primary); }
    .modal-close {
      position: absolute;
      top: 20px; right: 25px;
      font-size: 36px;
      cursor: pointer;
      color: #fff;
      opacity: 0.8;
      transition: opacity 0.2s;
    }
    .modal-close:hover { opacity: 1; }

    /* FORMS */
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #444; font-size: 14px; }
    .form-group input {
      width: 100%;
      padding: 15px 18px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      background: #fafafa;
      transition: all 0.2s;
    }
    .form-group input:focus { outline: none; border-color: var(--primary); background: #fff; }
    .error-msg { background: #fff0f0; color: #c00; padding: 12px 15px; margin-bottom: 20px; border-radius: 8px; border-left: 4px solid #c00; font-size: 14px; }

    /* BUTTONS */
    .btn {
      padding: 15px 30px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.2s;
    }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-primary:hover { background: var(--secondary); transform: translateY(-2px); }
    .btn-secondary { background: #f0f0f0; color: #333; }
    .btn-secondary:hover { background: #e0e0e0; }
    .btn-block { width: 100%; }
    .btn-lg { padding: 18px 36px; font-size: 18px; }

    /* MAIN APP */
    .main-app { display: none; min-height: 100vh; }
    .main-app.active { display: block; }

    /* HEADER */
    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: #fff;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }
    .header-right { display: flex; align-items: center; gap: 20px; }
    .header-user { 
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(255,255,255,0.1);
      padding: 8px 16px;
      border-radius: 25px;
    }
    .header-user .avatar {
      width: 32px;
      height: 32px;
      background: #fff;
      color: var(--primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
    }
    .header-btn {
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.3);
      color: #fff;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }
    .header-btn:hover { background: rgba(255,255,255,0.25); }

    /* KIOSK LAYOUT */
    .kiosk-container { display: flex; height: calc(100vh - 72px); }
    .products-section {
      flex: 2;
      padding: 25px;
      overflow-y: auto;
      background: #f5f5f5;
    }
    .cart-section {
      flex: 1;
      min-width: 400px;
      background: #fff;
      display: flex;
      flex-direction: column;
      box-shadow: -5px 0 30px rgba(0,0,0,0.1);
    }

    /* SEARCH */
    .search-bar { margin-bottom: 20px; }
    .search-bar input {
      width: 100%;
      padding: 18px 25px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    .search-bar input:focus { outline: none; border-color: var(--primary); }

    /* CATEGORIES */
    .categories { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 25px; }
    .category-btn {
      padding: 12px 24px;
      background: #fff;
      border: 2px solid #e0e0e0;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: #555;
      transition: all 0.2s;
    }
    .category-btn:hover { border-color: var(--primary); color: var(--primary); }
    .category-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }

    /* PRODUCTS */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 20px;
    }
    .product-card {
      background: #fff;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      border-radius: 16px;
      border: 2px solid transparent;
      transition: all 0.3s;
      box-shadow: 0 3px 15px rgba(0,0,0,0.05);
    }
    .product-card:hover { border-color: var(--primary); transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    .product-card .tag {
      font-size: 10px;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
      padding: 4px 12px;
      background: #f5f5f5;
      border-radius: 20px;
      display: inline-block;
    }
    .product-card .name { font-size: 15px; font-weight: 600; margin-bottom: 8px; color: #333; }
    .product-card .price { font-size: 22px; font-weight: 700; color: var(--primary); }
    .product-card .stock { font-size: 12px; color: #888; margin-top: 10px; }
    .product-card.out { opacity: 0.5; pointer-events: none; }

    /* CART */
    .cart-header {
      padding: 25px;
      border-bottom: 1px solid #eee;
      background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%);
    }
    .cart-header h2 { font-size: 22px; color: var(--primary); display: flex; align-items: center; gap: 10px; }
    .cart-header .count { background: var(--primary); color: #fff; padding: 4px 12px; border-radius: 20px; font-size: 14px; }
    .cart-items { flex: 1; overflow-y: auto; padding: 15px 20px; }
    .cart-empty { text-align: center; padding: 60px 20px; color: #999; }
    .cart-empty .icon { font-size: 64px; margin-bottom: 15px; opacity: 0.3; }
    
    .cart-item {
      display: flex;
      align-items: center;
      padding: 18px;
      border-radius: 12px;
      margin-bottom: 12px;
      background: #f9f9f9;
      transition: all 0.2s;
    }
    .cart-item:hover { background: #f0f0f0; }
    .cart-item-info { flex: 1; }
    .cart-item-name { font-weight: 600; color: #333; margin-bottom: 4px; }
    .cart-item-price { font-size: 13px; color: #888; }
    .cart-item-qty { display: flex; align-items: center; gap: 12px; }
    .qty-btn {
      width: 38px; height: 38px;
      border-radius: 50%;
      border: 2px solid #ddd;
      background: #fff;
      cursor: pointer;
      font-size: 20px;
      font-weight: bold;
      color: #555;
      transition: all 0.2s;
    }
    .qty-btn:hover { background: var(--primary); color: #fff; border-color: var(--primary); }
    .qty-value { font-weight: 700; font-size: 18px; min-width: 30px; text-align: center; }
    .cart-item-subtotal { font-weight: 700; font-size: 16px; min-width: 90px; text-align: right; color: var(--primary); }
    .cart-item-remove { margin-left: 12px; background: none; border: none; cursor: pointer; font-size: 20px; color: #ccc; }
    .cart-item-remove:hover { color: var(--danger); }

    .cart-footer {
      padding: 25px;
      border-top: 2px solid #eee;
      background: linear-gradient(180deg, #fafafa 0%, #f5f5f5 100%);
    }
    .cart-totals { margin-bottom: 20px; }
    .cart-row { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 15px; color: #666; }
    .cart-row.total {
      font-size: 26px;
      font-weight: 700;
      color: var(--primary);
      padding-top: 15px;
      border-top: 2px solid #e0e0e0;
      margin-top: 15px;
    }

    /* CHECKOUT */
    .checkout-screen {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
      z-index: 500;
      overflow-y: auto;
    }
    .checkout-screen.active { display: block; }
    .checkout-container { max-width: 600px; margin: 0 auto; padding: 50px 20px; }
    .checkout-header { text-align: center; margin-bottom: 35px; }
    .checkout-header h1 { font-size: 36px; color: var(--primary); margin-bottom: 10px; }
    .checkout-header p { color: #888; }
    
    .checkout-card {
      background: #fff;
      padding: 30px;
      margin-bottom: 25px;
      border-radius: 16px;
      box-shadow: 0 5px 25px rgba(0,0,0,0.08);
    }
    .checkout-card h3 {
      font-size: 18px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
      color: var(--primary);
    }
    .order-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f5f5f5; }
    .order-item:last-child { border-bottom: none; }
    .order-total { display: flex; justify-content: space-between; font-size: 24px; font-weight: 700; padding-top: 20px; margin-top: 15px; border-top: 2px solid #eee; color: var(--primary); }

    .payment-methods { display: flex; gap: 15px; }
    .payment-method {
      flex: 1;
      padding: 25px 15px;
      text-align: center;
      border: 3px solid #e0e0e0;
      border-radius: 12px;
      background: #fff;
      cursor: pointer;
      transition: all 0.2s;
    }
    .payment-method:hover { border-color: var(--primary); }
    .payment-method.selected { border-color: var(--primary); background: #f8f8ff; }
    .payment-method .icon { font-size: 32px; margin-bottom: 8px; }
    .payment-method .label { font-weight: 700; font-size: 14px; }

    /* RECEIPT */
    .receipt-screen {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: var(--primary);
      z-index: 600;
      align-items: center;
      justify-content: center;
    }
    .receipt-screen.active { display: flex; }
    .receipt-box {
      background: #fff;
      width: 420px;
      max-width: 95%;
      max-height: 90vh;
      overflow-y: auto;
      border-radius: 20px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.3);
    }
    .receipt-paper { padding: 35px; font-family: 'Courier New', monospace; }
    .receipt-header { text-align: center; margin-bottom: 25px; padding-bottom: 25px; border-bottom: 2px dashed #ddd; }
    .receipt-header .store-logo { margin-bottom: 15px; }
    .receipt-header h2 { font-size: 24px; margin-bottom: 5px; }
    .receipt-header .info { font-size: 12px; color: #666; line-height: 1.6; }
    .receipt-meta { margin-top: 15px; padding-top: 15px; border-top: 1px dashed #ddd; font-size: 12px; }
    .receipt-items { margin-bottom: 20px; }
    .receipt-item { display: flex; justify-content: space-between; padding: 8px 0; font-size: 13px; }
    .receipt-summary { border-top: 2px dashed #ddd; padding-top: 15px; }
    .receipt-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 14px; }
    .receipt-row.total { font-size: 20px; font-weight: 700; padding-top: 12px; margin-top: 12px; border-top: 2px solid #333; }
    .receipt-footer { text-align: center; margin-top: 25px; padding-top: 20px; border-top: 2px dashed #ddd; font-size: 13px; color: #666; }
    .receipt-actions { padding: 20px; display: flex; gap: 15px; background: #f5f5f5; border-radius: 0 0 20px 20px; }
    .receipt-actions button { flex: 1; }

    /* ADMIN */
    .admin-nav {
      background: var(--secondary);
      padding: 0 30px;
      display: flex;
      gap: 5px;
    }
    .admin-nav button {
      background: transparent;
      border: none;
      color: rgba(255,255,255,0.7);
      padding: 18px 25px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      border-bottom: 3px solid transparent;
      transition: all 0.2s;
    }
    .admin-nav button:hover { color: #fff; background: rgba(255,255,255,0.1); }
    .admin-nav button.active { color: #fff; border-bottom-color: #fff; background: rgba(255,255,255,0.1); }

    .admin-content { padding: 30px; background: #f5f5f5; min-height: calc(100vh - 130px); }
    .admin-title { font-size: 28px; color: var(--primary); margin-bottom: 25px; }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .stat-box {
      background: #fff;
      padding: 28px;
      border-radius: 16px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.05);
    }
    .stat-box .icon { font-size: 36px; margin-bottom: 10px; }
    .stat-box .value { font-size: 38px; font-weight: 700; color: var(--primary); margin-bottom: 5px; }
    .stat-box .label { font-size: 14px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
    .stat-box.highlight { background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: #fff; }
    .stat-box.highlight .value, .stat-box.highlight .label { color: #fff; }

    .data-card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.05);
      margin-bottom: 25px;
      overflow: hidden;
    }
    .data-card-header {
      padding: 20px 25px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .data-card-header h3 { font-size: 18px; color: var(--primary); }
    .data-card-body { padding: 0; }

    .data-table { width: 100%; border-collapse: collapse; }
    .data-table th, .data-table td { padding: 16px 20px; text-align: left; border-bottom: 1px solid #f0f0f0; }
    .data-table th { background: #fafafa; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: #888; font-weight: 600; }
    .data-table tr:hover { background: #fafafa; }
    .data-table tr:last-child td { border-bottom: none; }
    
    .badge { display: inline-block; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
    .badge-success { background: #e8f5e9; color: var(--success); }
    .badge-warning { background: #fff8e1; color: var(--warning); }
    .badge-danger { background: #ffebee; color: var(--danger); }

    .stock-bar { height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden; width: 100px; display: inline-block; vertical-align: middle; margin-left: 10px; }
    .stock-bar-fill { height: 100%; background: var(--success); border-radius: 4px; }
    .stock-bar-fill.low { background: var(--warning); }
    .stock-bar-fill.critical { background: var(--danger); }

    .hidden { display: none !important; }
  </style>
</head>
<body>
  <!-- WELCOME SCREEN -->
  <div id="welcomeScreen" class="welcome-screen">
    <div class="welcome-logo">
      <div class="logo-icon">
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 6h18l-2 13H5L3 6z" stroke="#1a1a2e" stroke-width="2" fill="none"/>
          <path d="M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2" stroke="#1a1a2e" stroke-width="2"/>
          <circle cx="9" cy="11" r="1" fill="#1a1a2e"/>
          <circle cx="15" cy="11" r="1" fill="#1a1a2e"/>
          <path d="M9 14h6" stroke="#1a1a2e" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <h1>Quick<span>Mart</span></h1>
    </div>
    <p class="welcome-subtitle">Self-Service Point of Sale System</p>
    
    <div class="welcome-options">
      <button class="welcome-option" onclick="startGuest()">
        <div class="icon">&#128722;</div>
        <h2>Quick Checkout</h2>
        <p>Shop as guest customer. Scan items, pay and collect your receipt.</p>
      </button>
      
      <button class="welcome-option" onclick="openLoginModal('customer')">
        <div class="icon">&#128100;</div>
        <h2>Member Sign In</h2>
        <p>Log in to earn loyalty points and view your purchase history.</p>
      </button>
      
      <button class="welcome-option" onclick="openLoginModal('admin')">
        <div class="icon">&#128736;</div>
        <h2>Staff Portal</h2>
        <p>Admin access for inventory management, sales reports and more.</p>
      </button>
    </div>
    
    <div class="welcome-footer">
      <p>Touch anywhere to begin your shopping experience</p>
      <div class="currency">All prices displayed in South African Rand (ZAR) | VAT Inclusive</div>
    </div>
  </div>

  <!-- LOGIN MODAL -->
  <div id="loginModal" class="modal-overlay">
    <span class="modal-close" onclick="closeLoginModal()">&times;</span>
    <div class="modal-box">
      <h2 id="loginTitle">Sign In</h2>
      <div id="loginError" class="error-msg hidden"></div>
      <form onsubmit="handleLogin(event)">
        <div class="form-group">
          <label>Username</label>
          <input type="text" id="loginUsername" required placeholder="Enter your username">
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="loginPassword" required placeholder="Enter your password">
        </div>
        <button type="submit" class="btn btn-primary btn-block btn-lg">Sign In</button>
      </form>
      <div id="registerLink" style="margin-top: 25px; text-align: center;">
        <p style="color: #888; margin-bottom: 12px;">New customer?</p>
        <button class="btn btn-secondary btn-block" onclick="showRegister()">Create Free Account</button>
      </div>
      <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid #eee; font-size: 13px; color: #888; text-align: center;">
        <strong>Demo Accounts:</strong><br>
        <span style="display: inline-block; margin-top: 8px;">Admin: <code>admin</code> / <code>admin123</code></span><br>
        <span>Member: <code>sarah.j</code> / <code>cust123</code></span>
      </div>
    </div>
  </div>

  <!-- REGISTER MODAL -->
  <div id="registerModal" class="modal-overlay">
    <span class="modal-close" onclick="closeRegisterModal()">&times;</span>
    <div class="modal-box">
      <h2>Create Account</h2>
      <div id="registerError" class="error-msg hidden"></div>
      <form onsubmit="handleRegister(event)">
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" id="regName" required placeholder="Enter your full name">
        </div>
        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="regEmail" required placeholder="you@example.com">
        </div>
        <div class="form-group">
          <label>Username</label>
          <input type="text" id="regUsername" required placeholder="Choose a username">
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="regPassword" required placeholder="Choose a secure password">
        </div>
        <div class="form-group">
          <label>Phone Number</label>
          <input type="tel" id="regPhone" placeholder="Optional">
        </div>
        <button type="submit" class="btn btn-primary btn-block btn-lg">Create Account</button>
      </form>
      <button class="btn btn-secondary btn-block" style="margin-top: 15px;" onclick="backToLogin()">Back to Sign In</button>
    </div>
  </div>

  <!-- KIOSK APP -->
  <div id="kioskApp" class="main-app">
    <header class="header">
      <div class="logo">
        <div class="logo-icon">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M3 6h18l-2 13H5L3 6z" stroke="#1a1a2e" stroke-width="2"/>
            <path d="M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2" stroke="#1a1a2e" stroke-width="2"/>
          </svg>
        </div>
        <div class="logo-text">Quick<span>Mart</span></div>
      </div>
      <div class="header-right">
        <div class="header-user">
          <div class="avatar" id="userAvatar">G</div>
          <span id="userDisplay">Guest</span>
        </div>
        <button class="header-btn" onclick="logout()">Exit</button>
      </div>
    </header>

    <div class="kiosk-container">
      <div class="products-section">
        <div class="search-bar">
          <input type="text" id="searchInput" placeholder="Search products by name or scan barcode..." oninput="filterProducts()">
        </div>
        <div class="categories" id="categoriesContainer"></div>
        <div class="products-grid" id="productsGrid"></div>
      </div>

      <div class="cart-section">
        <div class="cart-header">
          <h2>Your Cart <span class="count" id="cartCount">0</span></h2>
        </div>
        <div class="cart-items" id="cartItems">
          <div class="cart-empty">
            <div class="icon">&#128722;</div>
            <p>Your cart is empty</p>
            <p style="font-size: 13px; margin-top: 8px;">Tap products to add them</p>
          </div>
        </div>
        <div class="cart-footer">
          <div class="cart-totals">
            <div class="cart-row"><span>Subtotal:</span><span id="cartSubtotal">R0.00</span></div>
            <div class="cart-row"><span>VAT (15%):</span><span id="cartTax">R0.00</span></div>
            <div class="cart-row total"><span>Total:</span><span id="cartTotal">R0.00</span></div>
          </div>
          <button class="btn btn-primary btn-block btn-lg" id="checkoutBtn" onclick="goToCheckout()" disabled>
            Proceed to Payment
          </button>
          <button class="btn btn-secondary btn-block" onclick="clearCart()" style="margin-top: 12px;">Clear Cart</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ADMIN APP -->
  <div id="adminApp" class="main-app">
    <header class="header">
      <div class="logo">
        <div class="logo-icon">
          <svg viewBox="0 0 24 24" fill="none">
            <path d="M3 6h18l-2 13H5L3 6z" stroke="#1a1a2e" stroke-width="2"/>
            <path d="M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2" stroke="#1a1a2e" stroke-width="2"/>
          </svg>
        </div>
        <div class="logo-text">Quick<span>Mart</span> Admin</div>
      </div>
      <div class="header-right">
        <div class="header-user">
          <div class="avatar" id="adminAvatar">A</div>
          <span id="adminUserDisplay">Admin</span>
        </div>
        <button class="header-btn" onclick="logout()">Logout</button>
      </div>
    </header>
    <nav class="admin-nav" id="adminNav">
      <button class="active" onclick="showAdminTab('dashboard', this)">Dashboard</button>
      <button onclick="showAdminTab('sales', this)">Sales History</button>
      <button onclick="showAdminTab('products', this)">Inventory</button>
      <button onclick="showAdminTab('customers', this)">Customers</button>
      <button onclick="showAdminTab('reports', this)">Reports</button>
    </nav>
    <div class="admin-content" id="adminContent"></div>
  </div>

  <!-- CHECKOUT SCREEN -->
  <div id="checkoutScreen" class="checkout-screen">
    <div class="checkout-container">
      <div class="checkout-header">
        <h1>Checkout</h1>
        <p>Review your order and select payment method</p>
      </div>

      <div class="checkout-card">
        <h3>Order Summary</h3>
        <div id="checkoutItems"></div>
        <div class="order-total">
          <span>Total to Pay:</span>
          <span id="checkoutTotal">R0.00</span>
        </div>
      </div>

      <div class="checkout-card">
        <h3>Select Payment Method</h3>
        <div class="payment-methods">
          <div class="payment-method selected" onclick="selectPayment('card', this)">
            <div class="icon">&#128179;</div>
            <div class="label">Card</div>
          </div>
          <div class="payment-method" onclick="selectPayment('cash', this)">
            <div class="icon">&#128181;</div>
            <div class="label">Cash</div>
          </div>
          <div class="payment-method" onclick="selectPayment('mobile', this)">
            <div class="icon">&#128241;</div>
            <div class="label">Mobile</div>
          </div>
        </div>
      </div>

      <button class="btn btn-primary btn-block btn-lg" onclick="processPayment()">Complete Payment</button>
      <button class="btn btn-secondary btn-block" onclick="backToCart()" style="margin-top: 15px;">Back to Cart</button>
    </div>
  </div>

  <!-- RECEIPT SCREEN -->
  <div id="receiptScreen" class="receipt-screen">
    <div class="receipt-box">
      <div class="receipt-paper" id="receiptPaper"></div>
      <div class="receipt-actions">
        <button class="btn btn-secondary" onclick="printReceipt()">Print Receipt</button>
        <button class="btn btn-primary" onclick="finishTransaction()">Done</button>
      </div>
    </div>
  </div>

  <script>
    // ========== STATE ==========
    let currentUser = null;
    let loginMode = 'customer';
    let products = [];
    let customers = [];
    let sales = [];
    let cart = [];
    let selectedCategory = 'All';
    let selectedPayment = 'card';

    // ========== API ==========
    const api = {
      get: async (url) => {
        try {
          const res = await fetch('/api' + url);
          return await res.json();
        } catch (e) {
          console.error('API Error:', e);
          return [];
        }
      },
      post: async (url, data) => {
        try {
          const res = await fetch('/api' + url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
          return await res.json();
        } catch (e) {
          console.error('API Error:', e);
          return { success: false, error: 'Connection error' };
        }
      }
    };

    // ========== WELCOME ==========
    function startGuest() {
      currentUser = { role: 'guest', name: 'Guest Customer' };
      startKiosk();
    }

    function openLoginModal(mode) {
      loginMode = mode;
      document.getElementById('loginTitle').textContent = mode === 'admin' ? 'Staff Sign In' : 'Member Sign In';
      document.getElementById('registerLink').style.display = mode === 'admin' ? 'none' : 'block';
      document.getElementById('loginModal').classList.add('active');
      document.getElementById('loginError').classList.add('hidden');
    }

    function closeLoginModal() {
      document.getElementById('loginModal').classList.remove('active');
      document.getElementById('loginUsername').value = '';
      document.getElementById('loginPassword').value = '';
    }

    function showRegister() {
      closeLoginModal();
      document.getElementById('registerModal').classList.add('active');
    }

    function closeRegisterModal() {
      document.getElementById('registerModal').classList.remove('active');
    }

    function backToLogin() {
      closeRegisterModal();
      openLoginModal('customer');
    }

    async function handleLogin(e) {
      e.preventDefault();
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;
      
      console.log('Attempting login:', username);
      
      const result = await api.post('/login', { username, password });
      console.log('Login result:', result);

      if (result.success) {
        currentUser = result.user;
        closeLoginModal();
        if (currentUser.role === 'admin') {
          startAdmin();
        } else {
          startKiosk();
        }
      } else {
        document.getElementById('loginError').textContent = result.error || 'Login failed';
        document.getElementById('loginError').classList.remove('hidden');
      }
    }

    async function handleRegister(e) {
      e.preventDefault();
      const result = await api.post('/register', {
        name: document.getElementById('regName').value,
        email: document.getElementById('regEmail').value,
        username: document.getElementById('regUsername').value,
        password: document.getElementById('regPassword').value,
        phone: document.getElementById('regPhone').value
      });

      if (result.success) {
        currentUser = result.user;
        closeRegisterModal();
        startKiosk();
      } else {
        document.getElementById('registerError').textContent = result.error;
        document.getElementById('registerError').classList.remove('hidden');
      }
    }

    function logout() {
      currentUser = null;
      cart = [];
      document.getElementById('kioskApp').classList.remove('active');
      document.getElementById('adminApp').classList.remove('active');
      document.getElementById('welcomeScreen').style.display = 'flex';
    }

    // ========== KIOSK ==========
    async function startKiosk() {
      document.getElementById('welcomeScreen').style.display = 'none';
      document.getElementById('kioskApp').classList.add('active');
      document.getElementById('userDisplay').textContent = currentUser.name;
      document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
      
      products = await api.get('/products');
      renderCategories();
      renderProducts();
      renderCart();
    }

    function renderCategories() {
      const cats = ['All', ...new Set(products.map(p => p.category))];
      document.getElementById('categoriesContainer').innerHTML = cats.map(c =>
        `<button class="category-btn ${c === selectedCategory ? 'active' : ''}" onclick="selectCategory('${c}')">${c}</button>`
      ).join('');
    }

    function selectCategory(cat) {
      selectedCategory = cat;
      renderCategories();
      renderProducts();
    }

    function renderProducts() {
      const search = document.getElementById('searchInput')?.value.toLowerCase() || '';
      const filtered = products.filter(p => {
        const matchCat = selectedCategory === 'All' || p.category === selectedCategory;
        const matchSearch = p.name.toLowerCase().includes(search) || (p.barcode && p.barcode.includes(search));
        return matchCat && matchSearch;
      });

      document.getElementById('productsGrid').innerHTML = filtered.map(p => `
        <div class="product-card ${p.stock <= 0 ? 'out' : ''}" onclick="addToCart(${p.id})">
          <div class="tag">${p.category}</div>
          <div class="name">${p.name}</div>
          <div class="price">R${p.price.toFixed(2)}</div>
          <div class="stock">${p.stock > 0 ? p.stock + ' available' : 'Out of stock'}</div>
        </div>
      `).join('');
    }

    function filterProducts() { renderProducts(); }

    function addToCart(productId) {
      const product = products.find(p => p.id === productId);
      if (!product || product.stock <= 0) return;

      const existing = cart.find(c => c.productId === productId);
      if (existing) {
        if (existing.quantity >= product.stock) { alert('Maximum stock reached'); return; }
        existing.quantity++;
      } else {
        cart.push({ productId, name: product.name, price: product.price, quantity: 1, maxStock: product.stock });
      }
      renderCart();
    }

    function updateQty(productId, delta) {
      const item = cart.find(c => c.productId === productId);
      if (!item) return;

      item.quantity += delta;
      if (item.quantity <= 0) cart = cart.filter(c => c.productId !== productId);
      else if (item.quantity > item.maxStock) item.quantity = item.maxStock;
      renderCart();
    }

    function removeItem(productId) {
      cart = cart.filter(c => c.productId !== productId);
      renderCart();
    }

    function clearCart() {
      cart = [];
      renderCart();
    }

    function renderCart() {
      const container = document.getElementById('cartItems');
      document.getElementById('cartCount').textContent = cart.reduce((sum, c) => sum + c.quantity, 0);
      
      if (cart.length === 0) {
        container.innerHTML = `<div class="cart-empty"><div class="icon">&#128722;</div><p>Your cart is empty</p><p style="font-size: 13px; margin-top: 8px;">Tap products to add them</p></div>`;
        document.getElementById('cartSubtotal').textContent = 'R0.00';
        document.getElementById('cartTax').textContent = 'R0.00';
        document.getElementById('cartTotal').textContent = 'R0.00';
        document.getElementById('checkoutBtn').disabled = true;
        return;
      }

      container.innerHTML = cart.map(item => `
        <div class="cart-item">
          <div class="cart-item-info">
            <div class="cart-item-name">${item.name}</div>
            <div class="cart-item-price">R${item.price.toFixed(2)} each</div>
          </div>
          <div class="cart-item-qty">
            <button class="qty-btn" onclick="updateQty(${item.productId}, -1)">-</button>
            <span class="qty-value">${item.quantity}</span>
            <button class="qty-btn" onclick="updateQty(${item.productId}, 1)">+</button>
          </div>
          <div class="cart-item-subtotal">R${(item.price * item.quantity).toFixed(2)}</div>
          <button class="cart-item-remove" onclick="removeItem(${item.productId})">&times;</button>
        </div>
      `).join('');

      const subtotal = cart.reduce((sum, i) => sum + i.price * i.quantity, 0);
      const tax = subtotal * 0.15;
      const total = subtotal + tax;

      document.getElementById('cartSubtotal').textContent = 'R' + subtotal.toFixed(2);
      document.getElementById('cartTax').textContent = 'R' + tax.toFixed(2);
      document.getElementById('cartTotal').textContent = 'R' + total.toFixed(2);
      document.getElementById('checkoutBtn').disabled = false;
    }

    // ========== CHECKOUT ==========
    function goToCheckout() {
      if (cart.length === 0) return;

      document.getElementById('checkoutItems').innerHTML = cart.map(item => `
        <div class="order-item">
          <span>${item.quantity} x ${item.name}</span>
          <span>R${(item.price * item.quantity).toFixed(2)}</span>
        </div>
      `).join('');

      const total = cart.reduce((sum, i) => sum + i.price * i.quantity, 0) * 1.15;
      document.getElementById('checkoutTotal').textContent = 'R' + total.toFixed(2);
      document.getElementById('checkoutScreen').classList.add('active');
    }

    function backToCart() {
      document.getElementById('checkoutScreen').classList.remove('active');
    }

    function selectPayment(method, el) {
      selectedPayment = method;
      document.querySelectorAll('.payment-method').forEach(p => p.classList.remove('selected'));
      el.classList.add('selected');
    }

    async function processPayment() {
      const sale = await api.post('/sales', {
        items: cart.map(c => ({ productId: c.productId, quantity: c.quantity })),
        customerId: currentUser.customerId || null,
        paymentMethod: selectedPayment,
        isKiosk: true
      });

      document.getElementById('checkoutScreen').classList.remove('active');
      showReceipt(sale);
    }

    function showReceipt(sale) {
      document.getElementById('receiptPaper').innerHTML = `
        <div class="receipt-header">
          <div class="store-logo" style="font-size: 32px; font-weight: 700;">QuickMart</div>
          <div class="info">
            Self-Service POS<br>
            123 Main Street, Johannesburg<br>
            Tel: 011-555-1234 | VAT: 4850123456
          </div>
          <div class="receipt-meta">
            <div><strong>Receipt:</strong> ${sale.receiptNumber}</div>
            <div>${new Date(sale.timestamp).toLocaleString()}</div>
          </div>
        </div>
        <div class="receipt-items">
          ${sale.items.map(i => `
            <div class="receipt-item">
              <span>${i.quantity} x ${i.name}</span>
              <span>R${i.subtotal.toFixed(2)}</span>
            </div>
          `).join('')}
        </div>
        <div class="receipt-summary">
          <div class="receipt-row"><span>Subtotal:</span><span>R${sale.subtotal.toFixed(2)}</span></div>
          <div class="receipt-row"><span>VAT (15%):</span><span>R${sale.tax.toFixed(2)}</span></div>
          <div class="receipt-row total"><span>TOTAL:</span><span>R${sale.total.toFixed(2)}</span></div>
          <div class="receipt-row" style="margin-top: 12px;"><span>Payment:</span><span>${sale.paymentMethod.toUpperCase()}</span></div>
        </div>
        <div class="receipt-footer">
          <strong>Customer: ${sale.customerName}</strong><br><br>
          Thank you for shopping with QuickMart!<br>
          Visit us again soon.
        </div>
      `;
      document.getElementById('receiptScreen').classList.add('active');
    }

    function printReceipt() { window.print(); }

    async function finishTransaction() {
      document.getElementById('receiptScreen').classList.remove('active');
      cart = [];
      renderCart();
      products = await api.get('/products');
      renderProducts();
    }

    // ========== ADMIN ==========
    async function startAdmin() {
      document.getElementById('welcomeScreen').style.display = 'none';
      document.getElementById('adminApp').classList.add('active');
      document.getElementById('adminUserDisplay').textContent = currentUser.name;
      document.getElementById('adminAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
      
      products = await api.get('/products');
      customers = await api.get('/customers');
      sales = await api.get('/sales');
      
      showAdminTab('dashboard', document.querySelector('#adminNav button'));
    }

    async function showAdminTab(tab, btn) {
      document.querySelectorAll('#adminNav button').forEach(b => b.classList.remove('active'));
      if (btn) btn.classList.add('active');

      const content = document.getElementById('adminContent');

      if (tab === 'dashboard') {
        const stats = await api.get('/stats');
        const lowStock = products.filter(p => p.stock < 20);
        const recentSales = sales.slice(-5).reverse();
        
        content.innerHTML = `
          <h2 class="admin-title">Store Dashboard</h2>
          <div class="stats-grid">
            <div class="stat-box highlight">
              <div class="icon">&#128176;</div>
              <div class="value">R${stats.todaySales}</div>
              <div class="label">Today's Revenue</div>
            </div>
            <div class="stat-box">
              <div class="icon">&#128722;</div>
              <div class="value">${stats.todayTransactions}</div>
              <div class="label">Transactions Today</div>
            </div>
            <div class="stat-box">
              <div class="icon">&#128230;</div>
              <div class="value">${stats.totalProducts}</div>
              <div class="label">Total Products</div>
            </div>
            <div class="stat-box">
              <div class="icon">&#9888;</div>
              <div class="value">${stats.lowStockItems}</div>
              <div class="label">Low Stock Alerts</div>
            </div>
            <div class="stat-box">
              <div class="icon">&#128101;</div>
              <div class="value">${stats.totalCustomers}</div>
              <div class="label">Registered Customers</div>
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
            <div class="data-card">
              <div class="data-card-header"><h3>Recent Sales</h3></div>
              <div class="data-card-body">
                <table class="data-table">
                  <thead><tr><th>Receipt</th><th>Customer</th><th>Amount</th></tr></thead>
                  <tbody>
                    ${recentSales.map(s => `
                      <tr>
                        <td><strong>${s.receiptNumber}</strong></td>
                        <td>${s.customerName}</td>
                        <td><strong>R${s.total.toFixed(2)}</strong></td>
                      </tr>
                    `).join('') || '<tr><td colspan="3" style="text-align:center;color:#888;">No sales yet today</td></tr>'}
                  </tbody>
                </table>
              </div>
            </div>
            
            <div class="data-card">
              <div class="data-card-header"><h3>Low Stock Items</h3></div>
              <div class="data-card-body">
                <table class="data-table">
                  <thead><tr><th>Product</th><th>Stock Level</th></tr></thead>
                  <tbody>
                    ${lowStock.slice(0, 5).map(p => {
                      const pct = Math.min(100, (p.stock / 50) * 100);
                      const cls = p.stock < 10 ? 'critical' : p.stock < 20 ? 'low' : '';
                      return `
                        <tr>
                          <td>${p.name}</td>
                          <td>
                            <span class="badge ${p.stock < 10 ? 'badge-danger' : 'badge-warning'}">${p.stock} units</span>
                            <div class="stock-bar"><div class="stock-bar-fill ${cls}" style="width: ${pct}%"></div></div>
                          </td>
                        </tr>
                      `;
                    }).join('') || '<tr><td colspan="2" style="text-align:center;color:#888;">All items well stocked</td></tr>'}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        `;
      } else if (tab === 'sales') {
        sales = await api.get('/sales');
        content.innerHTML = `
          <h2 class="admin-title">Sales History</h2>
          <div class="data-card">
            <div class="data-card-header">
              <h3>All Transactions</h3>
              <span style="color: #888;">${sales.length} total sales</span>
            </div>
            <div class="data-card-body">
              <table class="data-table">
                <thead>
                  <tr><th>Receipt #</th><th>Customer</th><th>Items</th><th>Subtotal</th><th>VAT</th><th>Total</th><th>Payment</th><th>Date</th></tr>
                </thead>
                <tbody>
                  ${sales.slice().reverse().map(s => `
                    <tr>
                      <td><strong>${s.receiptNumber}</strong></td>
                      <td>${s.customerName}</td>
                      <td>${s.items.length} items</td>
                      <td>R${s.subtotal.toFixed(2)}</td>
                      <td>R${s.tax.toFixed(2)}</td>
                      <td><strong style="color: var(--success);">R${s.total.toFixed(2)}</strong></td>
                      <td><span class="badge badge-success">${s.paymentMethod.toUpperCase()}</span></td>
                      <td>${new Date(s.timestamp).toLocaleString()}</td>
                    </tr>
                  `).join('') || '<tr><td colspan="8" style="text-align:center;color:#888;padding:40px;">No sales recorded yet</td></tr>'}
                </tbody>
              </table>
            </div>
          </div>
        `;
      } else if (tab === 'products') {
        products = await api.get('/products');
        content.innerHTML = `
          <h2 class="admin-title">Product Inventory</h2>
          <div class="data-card">
            <div class="data-card-header">
              <h3>All Products</h3>
              <span style="color: #888;">${products.length} products</span>
            </div>
            <div class="data-card-body">
              <table class="data-table">
                <thead>
                  <tr><th>Product Name</th><th>Category</th><th>Price</th><th>Stock</th><th>Status</th><th>Barcode</th></tr>
                </thead>
                <tbody>
                  ${products.map(p => {
                    const status = p.stock === 0 ? 'Out of Stock' : p.stock < 10 ? 'Critical' : p.stock < 20 ? 'Low Stock' : 'In Stock';
                    const badge = p.stock === 0 ? 'badge-danger' : p.stock < 10 ? 'badge-danger' : p.stock < 20 ? 'badge-warning' : 'badge-success';
                    return `
                      <tr>
                        <td><strong>${p.name}</strong></td>
                        <td>${p.category}</td>
                        <td>R${p.price.toFixed(2)}</td>
                        <td>${p.stock} units</td>
                        <td><span class="badge ${badge}">${status}</span></td>
                        <td style="font-family: monospace; color: #888;">${p.barcode || '-'}</td>
                      </tr>
                    `;
                  }).join('')}
                </tbody>
              </table>
            </div>
          </div>
        `;
      } else if (tab === 'customers') {
        customers = await api.get('/customers');
        content.innerHTML = `
          <h2 class="admin-title">Customer Management</h2>
          <div class="data-card">
            <div class="data-card-header">
              <h3>Registered Customers</h3>
              <span style="color: #888;">${customers.length} members</span>
            </div>
            <div class="data-card-body">
              <table class="data-table">
                <thead>
                  <tr><th>Customer Name</th><th>Email</th><th>Phone</th><th>Loyalty Points</th><th>Member Since</th></tr>
                </thead>
                <tbody>
                  ${customers.map(c => `
                    <tr>
                      <td><strong>${c.name}</strong></td>
                      <td>${c.email}</td>
                      <td>${c.phone}</td>
                      <td><span class="badge badge-success">${c.loyaltyPoints} pts</span></td>
                      <td>${c.memberSince}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
        `;
      } else if (tab === 'reports') {
        const totalRevenue = sales.reduce((sum, s) => sum + s.total, 0);
        const avgSale = sales.length > 0 ? totalRevenue / sales.length : 0;
        const topProducts = {};
        sales.forEach(s => s.items.forEach(i => {
          topProducts[i.name] = (topProducts[i.name] || 0) + i.quantity;
        }));
        const sortedProducts = Object.entries(topProducts).sort((a, b) => b[1] - a[1]).slice(0, 5);
        
        content.innerHTML = `
          <h2 class="admin-title">Sales Reports</h2>
          <div class="stats-grid">
            <div class="stat-box highlight">
              <div class="value">R${totalRevenue.toFixed(2)}</div>
              <div class="label">Total Revenue</div>
            </div>
            <div class="stat-box">
              <div class="value">${sales.length}</div>
              <div class="label">Total Transactions</div>
            </div>
            <div class="stat-box">
              <div class="value">R${avgSale.toFixed(2)}</div>
              <div class="label">Average Sale Value</div>
            </div>
          </div>
          
          <div class="data-card">
            <div class="data-card-header"><h3>Top Selling Products</h3></div>
            <div class="data-card-body">
              <table class="data-table">
                <thead><tr><th>Rank</th><th>Product</th><th>Units Sold</th></tr></thead>
                <tbody>
                  ${sortedProducts.map((p, i) => `
                    <tr>
                      <td><strong>#${i + 1}</strong></td>
                      <td>${p[0]}</td>
                      <td><span class="badge badge-success">${p[1]} units</span></td>
                    </tr>
                  `).join('') || '<tr><td colspan="3" style="text-align:center;color:#888;">No sales data yet</td></tr>'}
                </tbody>
              </table>
            </div>
          </div>
        `;
      }
    }
  </script>
</body>
</html>
