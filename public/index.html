<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>QuickMart POS - Self-Service Point of Sale</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f0f0; color: #333; }
    
    :root {
      --primary: #4CAF50;
      --secondary: #2E7D32;
      --accent: #1B5E20;
      --light: #e8e8e8;
      --white: #ffffff;
      --success: #2d5a27;
      --warning: #8b6914;
      --danger: #8b1414;
    }

    /* LOGO */
    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .logo-icon {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    }
    .logo-icon span { font-size: 28px; }
    .logo-text { font-size: 28px; font-weight: 700; color: #fff; letter-spacing: -1px; }
    .logo-text span { font-weight: 300; opacity: 0.8; }

    /* WELCOME SCREEN - Modern Clean Design (Snack Haven Style) */
    .welcome-screen {
      min-height: 100vh;
      background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%);
      display: flex;
      flex-direction: column;
      color: #1a1a2e;
      position: relative;
      overflow: hidden;
    }
    
    /* Subtle background pattern */
    .welcome-screen::before {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 60%;
      height: 100%;
      background: linear-gradient(135deg, transparent 0%, rgba(255, 140, 0, 0.03) 100%);
      pointer-events: none;
    }
    
    /* Top Navigation */
    .welcome-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 60px;
      background: #fff;
      box-shadow: 0 2px 20px rgba(0,0,0,0.05);
      position: relative;
      z-index: 10;
    }
    
    .nav-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
    }
    
    .nav-logo .logo-icon {
      width: 45px;
      height: 45px;
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .nav-logo .logo-icon svg {
      width: 28px;
      height: 28px;
    }
    
    .nav-logo .logo-icon svg path,
    .nav-logo .logo-icon svg circle {
      stroke: #fff;
      fill: none;
    }
    
    .nav-logo .logo-icon svg circle {
      fill: #fff;
    }
    
    .nav-logo .logo-icon span {
      font-size: 24px;
    }
    
    .nav-logo h2 {
      font-size: 24px;
      font-weight: 700;
      color: #1a1a2e;
    }
    
    .nav-logo h2 span {
      font-weight: 400;
      color: #4CAF50;
    }
    
    .nav-links {
      display: none;
    }
    
    .nav-cart {
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
      color: #fff;
      padding: 12px 28px;
      border-radius: 25px;
      border: none;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .nav-cart:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(76, 175, 80, 0.3);
    }
    
    /* Main split container */
    .welcome-main {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 60px 80px;
      gap: 80px;
      position: relative;
      z-index: 1;
    }
    
    /* Left side - Content */
    .welcome-left {
      flex: 1;
      max-width: 550px;
      text-align: left;
    }
    
    .welcome-badge {
      display: none;
    }
    
    .welcome-headline {
      font-size: 56px;
      font-weight: 700;
      line-height: 1.15;
      margin-bottom: 25px;
      color: #1a1a2e;
    }
    
    .welcome-headline .highlight {
      color: #4CAF50;
    }
    
    .welcome-desc {
      font-size: 17px;
      color: #666;
      line-height: 1.7;
      margin-bottom: 35px;
      max-width: 450px;
    }
    
    /* Start Shopping Button - Green */
    .start-shopping-btn {
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
      color: #fff;
      padding: 18px 40px;
      width: auto;
      display: inline-flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      text-align: center;
      border-radius: 30px;
      box-shadow: 0 15px 40px rgba(76, 175, 80, 0.35);
      font-size: 17px;
      font-weight: 600;
    }
    
    .start-shopping-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 20px 50px rgba(76, 175, 80, 0.45);
    }
    
    .start-shopping-btn .icon {
      font-size: 24px;
    }
    
    .start-shopping-btn .arrow {
      font-size: 20px;
      transition: transform 0.3s;
    }
    
    .start-shopping-btn:hover .arrow {
      transform: translateX(5px);
    }
    
    /* Stats Section */
    .welcome-stats {
      display: flex;
      gap: 50px;
      margin-top: 50px;
      padding-top: 30px;
      border-top: 1px solid #eee;
    }
    
    .stat-item {
      text-align: left;
    }
    
    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: #1a1a2e;
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 14px;
      color: #888;
    }
    
    /* Right side - Image */
    .welcome-right {
      flex: 1;
      max-width: 520px;
      position: relative;
    }
    
    .welcome-image {
      border-radius: 24px;
      overflow: hidden;
      box-shadow: 0 40px 80px rgba(0, 0, 0, 0.15);
      position: relative;
    }
    
    .welcome-image img {
      width: 100%;
      height: 420px;
      object-fit: cover;
      display: block;
    }
    
    /* Top Rated Badge */
    .image-badge {
      display: none;
    }
    
    .image-badge .badge-icon {
      font-size: 20px;
      color: #4CAF50;
    }
    
    .image-badge .badge-text {
      font-size: 12px;
      font-weight: 600;
      color: #1a1a2e;
      margin-top: 4px;
    }
    
    /* Promo Cards - SA Colors */
    .promo-cards {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }
    
    .promo-card {
      flex: 1;
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(76, 175, 80, 0.25);
      border: none;
      color: #fff;
    }
    
    .promo-card:last-child {
      background: linear-gradient(135deg, #2E7D32 0%, #1B5E20 100%);
      box-shadow: 0 10px 30px rgba(46, 125, 50, 0.25);
    }
    
    .promo-card h4 {
      font-size: 15px;
      color: #fff;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
    }
    
    .promo-card:last-child h4 {
      color: #fff;
    }
    
    .promo-card p {
      font-size: 13px;
      color: rgba(255,255,255,0.9);
      line-height: 1.5;
      margin: 0;
    }
    
    .promo-card:last-child p {
      color: rgba(255,255,255,0.9);
    }
    
    /* Promo card flex layout */
    .promo-card-content {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .promo-card-icon {
      width: 40px;
      height: 40px;
    }
    
    /* Discount Badge Sticker */
    .discount-badge {
      width: 55px;
      height: 55px;
      background: linear-gradient(135deg, #FF6B35 0%, #F7931E 100%);
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
      animation: pulse-badge 2s infinite;
      flex-shrink: 0;
    }
    .discount-badge .percent {
      font-size: 18px;
      font-weight: 800;
      color: white;
      line-height: 1;
    }
    .discount-badge .off {
      font-size: 9px;
      font-weight: 700;
      color: white;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    @keyframes pulse-badge {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    .promo-card h4 {
      margin: 0;
      font-size: 15px;
      font-weight: 600;
    }
    .promo-card p {
      margin: 4px 0 0;
    }
    
    /* Help modal styles */
    .help-content {
      text-align: left;
      margin-top: 20px;
    }
    .help-item {
      margin-bottom: 20px;
      padding: 15px;
      background: #f5f5f5;
      border-radius: 10px;
    }
    .help-item:last-child {
      margin-bottom: 0;
      background: #e8f5e9;
      border-left: 4px solid #4CAF50;
    }
    .help-item h4 {
      margin-bottom: 8px;
      color: #1a1a2e;
    }
    .help-item:last-child h4 {
      color: #2d5a27;
    }
    .help-item p {
      color: #666;
      font-size: 14px;
      margin: 0;
    }
    .help-close-btn {
      margin-top: 25px;
    }

    /* Member Link - Green filled like Start Shopping */
    .member-link {
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
      border: none;
      color: #fff;
      padding: 14px 30px;
      cursor: pointer;
      transition: all 0.3s ease;
      border-radius: 30px;
      font-size: 15px;
      margin-left: 15px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 10px 30px rgba(76, 175, 80, 0.3);
    }
    
    .member-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 40px rgba(76, 175, 80, 0.4);
    }
    
    .member-link .icon {
      font-size: 18px;
    }
    
    /* Hidden staff access */
    .staff-hint {
      display: none;
      color: #aaa;
      font-size: 12px;
      margin-top: 20px;
    }
    
    .staff-hint.visible {
      display: block;
    }
    
    /* Bottom bar - Contact & Help */
    .welcome-bottom {
      background: #fff;
      border-top: 1px solid #eee;
      padding: 20px 60px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .contact-info {
      display: flex;
      gap: 40px;
      flex-wrap: wrap;
    }
    
    .contact-item {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #666;
      font-size: 14px;
    }
    
    .contact-item .icon {
      font-size: 18px;
      color: #4CAF50;
    }
    
    .contact-item a {
      color: #555;
      text-decoration: none;
      transition: color 0.2s;
    }
    
    .contact-item a:hover {
      color: #4CAF50;
    }
    
    .help-btn {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      border: none;
      color: #fff;
      padding: 12px 28px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }
    
    .help-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(26, 26, 46, 0.3);
    }
    
    /* Responsive */
    @media (max-width: 1000px) {
      .welcome-main {
        flex-direction: column;
        padding: 40px 30px;
        gap: 40px;
      }
      .welcome-left {
        text-align: center;
        max-width: 100%;
      }
      .welcome-desc {
        max-width: 100%;
      }
      .welcome-headline {
        font-size: 40px;
      }
      .welcome-right {
        max-width: 100%;
        order: -1;
      }
      .welcome-image img {
        height: 280px;
      }
      .welcome-stats {
        justify-content: center;
      }
      .welcome-nav {
        padding: 15px 20px;
      }
      .nav-links {
        display: none;
      }
      .welcome-bottom {
        flex-direction: column;
        text-align: center;
        padding: 20px;
      }
      .contact-info {
        justify-content: center;
      }
    }
    
    /* Legacy styles */
    .welcome-content { display: none; }
    .welcome-logo { display: none; }
    .welcome-subtitle { display: none; }
    .welcome-options { display: flex; gap: 15px; flex-wrap: wrap; }
    .welcome-logo h1 span { font-weight: 300; opacity: 0.7; }
    .welcome-subtitle { font-size: 18px; color: rgba(255,255,255,0.7); margin-bottom: 35px; }
    
    .welcome-options { display: flex; flex-direction: column; align-items: center; gap: 20px; width: 100%; }
    
    /* Main Start Shopping Button - Premium */
    .start-shopping-btn {
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
      color: #fff;
      padding: 35px 50px;
      width: 100%;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border: none;
      text-align: center;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(76, 175, 80, 0.4), inset 0 1px 0 rgba(255,255,255,0.2);
      position: relative;
      overflow: hidden;
    }
    .start-shopping-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: 0.5s;
    }
    .start-shopping-btn:hover::before { left: 100%; }
    .start-shopping-btn:hover { transform: translateY(-5px) scale(1.02); box-shadow: 0 25px 60px rgba(76, 175, 80, 0.5); }
    .start-shopping-btn .icon { font-size: 64px; margin-bottom: 12px; }
    .start-shopping-btn h2 { font-size: 28px; margin-bottom: 8px; font-weight: 700; letter-spacing: 1px; }
    .start-shopping-btn p { font-size: 15px; opacity: 0.9; }
    
    /* Member Sign In Link - Green like other buttons */
    .member-link {
      background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
      border: none;
      color: #fff;
      padding: 16px 35px;
      cursor: pointer;
      transition: all 0.3s ease;
      border-radius: 12px;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 10px 30px rgba(76, 175, 80, 0.3);
    }
    .member-link:hover { transform: translateY(-2px); box-shadow: 0 15px 40px rgba(76, 175, 80, 0.4); }
    .member-link .icon { font-size: 20px; }
    
    /* Hidden staff access indicator */
    .staff-hint { display: none; color: rgba(255,255,255,0.3); font-size: 12px; margin-top: 20px; }
    .staff-hint.visible { display: block; }
    
    /* Legacy styles for compatibility */
    .welcome-option {
      background: rgba(255,255,255,0.95);
      color: #333;
      padding: 35px 40px;
      width: 300px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      text-align: center;
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      display: none; /* Hidden by default */
    }
    .welcome-option:hover { transform: translateY(-8px); box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
    .welcome-option .icon { font-size: 48px; margin-bottom: 15px; }
    .welcome-option h2 { font-size: 22px; margin-bottom: 10px; color: var(--primary); }
    .welcome-option p { color: #666; font-size: 14px; line-height: 1.5; }

    .welcome-footer { 
      position: absolute;
      bottom: 30px;
      left: 0;
      right: 0;
      color: rgba(255,255,255,0.5); 
      font-size: 14px; 
      z-index: 1;
    }
    .welcome-footer .currency { 
      background: rgba(255,255,255,0.08);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      padding: 10px 25px; 
      border-radius: 25px; 
      display: inline-block; 
      margin-top: 12px;
      border: 1px solid rgba(255,255,255,0.1);
    }

    /* MODAL */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .modal-overlay.active { display: flex; }
    .modal-box {
      background: #fff;
      padding: 40px;
      width: 420px;
      max-width: 95%;
      border-radius: 20px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.3);
    }
    .modal-box h2 { margin-bottom: 25px; text-align: center; font-size: 24px; color: var(--primary); }
    .modal-close {
      position: absolute;
      top: 20px; right: 25px;
      font-size: 36px;
      cursor: pointer;
      color: #fff;
      opacity: 0.8;
      transition: opacity 0.2s;
    }
    .modal-close:hover { opacity: 1; }

    /* FORMS */
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #444; font-size: 14px; }
    .form-group input {
      width: 100%;
      padding: 15px 18px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      background: #fafafa;
      transition: all 0.2s;
    }
    .form-group input:focus { outline: none; border-color: var(--primary); background: #fff; }
    .error-msg { background: #fff0f0; color: #c00; padding: 12px 15px; margin-bottom: 20px; border-radius: 8px; border-left: 4px solid #c00; font-size: 14px; }

    /* BUTTONS */
    .btn {
      padding: 15px 30px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.2s;
    }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-primary:hover { background: var(--secondary); transform: translateY(-2px); }
    .btn-secondary { background: #f0f0f0; color: #333; }
    .btn-secondary:hover { background: #e0e0e0; }
    .btn-block { width: 100%; }
    .btn-lg { padding: 18px 36px; font-size: 18px; }

    /* MAIN APP */
    .main-app { display: none; min-height: 100vh; }
    .main-app.active { display: block; }

    /* HEADER */
    .header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: #fff;
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }
    .header-right { display: flex; align-items: center; gap: 20px; }
    .header-user { 
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(255,255,255,0.1);
      padding: 8px 16px;
      border-radius: 25px;
    }
    .header-user .avatar {
      width: 32px;
      height: 32px;
      background: #fff;
      color: var(--primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
    }
    .header-btn {
      background: rgba(255,255,255,0.15);
      border: 1px solid rgba(255,255,255,0.3);
      color: #fff;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }
    .header-btn:hover { background: rgba(255,255,255,0.25); }

    /* KIOSK LAYOUT */
    .kiosk-container { display: flex; height: calc(100vh - 72px); }
    .products-section {
      flex: 2;
      padding: 25px;
      overflow-y: auto;
      background: #f5f5f5;
    }
    .cart-section {
      flex: 1;
      min-width: 400px;
      background: #fff;
      display: flex;
      flex-direction: column;
      box-shadow: -5px 0 30px rgba(0,0,0,0.1);
    }

    /* SEARCH */
    .search-bar { margin-bottom: 20px; }
    .search-bar input {
      width: 100%;
      padding: 18px 25px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    .search-bar input:focus { outline: none; border-color: var(--primary); }

    /* CATEGORIES */
    .categories { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 25px; }
    .category-btn {
      padding: 12px 24px;
      background: #fff;
      border: 2px solid #e0e0e0;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: #555;
      transition: all 0.2s;
    }
    .category-btn:hover { border-color: var(--primary); color: var(--primary); }
    .category-btn.active { background: var(--primary); color: #fff; border-color: var(--primary); }

    /* PRODUCTS */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 20px;
    }
    .product-card {
      background: #fff;
      padding: 15px;
      text-align: center;
      cursor: pointer;
      border-radius: 16px;
      border: 2px solid transparent;
      transition: all 0.3s;
      box-shadow: 0 3px 15px rgba(0,0,0,0.05);
    }
    .product-card:hover { border-color: var(--primary); transform: translateY(-5px); box-shadow: 0 10px 25px rgba(76,175,80,0.15); }
    .product-card .product-img {
      width: 80px;
      height: 80px;
      border-radius: 12px;
      object-fit: cover;
      margin: 0 auto 12px;
      background: #f5f5f5;
    }
    .product-card .tag {
      font-size: 10px;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
      padding: 4px 12px;
      background: #f5f5f5;
      border-radius: 20px;
      display: inline-block;
    }
    .product-card .name { font-size: 15px; font-weight: 600; margin-bottom: 8px; color: #333; }
    .product-card .price { font-size: 22px; font-weight: 700; color: var(--primary); }
    .product-card .stock { font-size: 12px; color: #888; margin-top: 10px; }
    .product-card.out { opacity: 0.5; pointer-events: none; }

    /* CART */
    .cart-header {
      padding: 25px;
      border-bottom: 1px solid #eee;
      background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%);
    }
    .cart-header h2 { font-size: 22px; color: var(--primary); display: flex; align-items: center; gap: 10px; }
    .cart-header .count { background: var(--primary); color: #fff; padding: 4px 12px; border-radius: 20px; font-size: 14px; }
    .cart-items { flex: 1; overflow-y: auto; padding: 15px 20px; }
    .cart-empty { text-align: center; padding: 60px 20px; color: #999; }
    .cart-empty .icon { font-size: 64px; margin-bottom: 15px; opacity: 0.3; }
    
    .cart-item {
      display: flex;
      align-items: center;
      padding: 18px;
      border-radius: 12px;
      margin-bottom: 12px;
      background: #f9f9f9;
      transition: all 0.2s;
    }
    .cart-item:hover { background: #f0f0f0; }
    .cart-item-info { flex: 1; }
    .cart-item-name { font-weight: 600; color: #333; margin-bottom: 4px; }
    .cart-item-price { font-size: 13px; color: #888; }
    .cart-item-qty { display: flex; align-items: center; gap: 12px; }
    .qty-btn {
      width: 38px; height: 38px;
      border-radius: 50%;
      border: 2px solid #ddd;
      background: #fff;
      cursor: pointer;
      font-size: 20px;
      font-weight: bold;
      color: #555;
      transition: all 0.2s;
    }
    .qty-btn:hover { background: var(--primary); color: #fff; border-color: var(--primary); }
    .qty-value { font-weight: 700; font-size: 18px; min-width: 30px; text-align: center; }
    .cart-item-subtotal { font-weight: 700; font-size: 16px; min-width: 90px; text-align: right; color: var(--primary); }
    .cart-item-remove { margin-left: 12px; background: none; border: none; cursor: pointer; font-size: 20px; color: #ccc; }
    .cart-item-remove:hover { color: var(--danger); }

    .cart-footer {
      padding: 25px;
      border-top: 2px solid #eee;
      background: linear-gradient(180deg, #fafafa 0%, #f5f5f5 100%);
    }
    .cart-totals { margin-bottom: 20px; }
    .cart-row { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 15px; color: #666; }
    .cart-row.total {
      font-size: 26px;
      font-weight: 700;
      color: var(--primary);
      padding-top: 15px;
      border-top: 2px solid #e0e0e0;
      margin-top: 15px;
    }

    /* CHECKOUT */
    .checkout-screen {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
      z-index: 500;
      overflow-y: auto;
    }
    .checkout-screen.active { display: block; }
    .checkout-container { max-width: 600px; margin: 0 auto; padding: 50px 20px; }
    .checkout-header { text-align: center; margin-bottom: 35px; }
    .checkout-header h1 { font-size: 36px; color: var(--primary); margin-bottom: 10px; }
    .checkout-header p { color: #888; }
    
    .checkout-card {
      background: #fff;
      padding: 30px;
      margin-bottom: 25px;
      border-radius: 16px;
      box-shadow: 0 5px 25px rgba(0,0,0,0.08);
    }
    .checkout-card h3 {
      font-size: 18px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
      color: var(--primary);
    }
    .order-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f5f5f5; }
    .order-item:last-child { border-bottom: none; }
    .order-total { display: flex; justify-content: space-between; font-size: 24px; font-weight: 700; padding-top: 20px; margin-top: 15px; border-top: 2px solid #eee; color: var(--primary); }

    .payment-methods { display: flex; gap: 15px; }
    .payment-method {
      flex: 1;
      padding: 20px 15px;
      text-align: center;
      border: 3px solid #e0e0e0;
      border-radius: 12px;
      background: #fff;
      cursor: pointer;
      transition: all 0.2s;
    }
    .payment-method:hover { border-color: var(--primary); }
    .payment-method.selected { border-color: var(--primary); background: #f0fff0; }
    .payment-method .icon { width: 50px; height: 35px; object-fit: contain; margin: 0 auto 10px; display: block; }
    .payment-method .label { font-weight: 700; font-size: 14px; }

    /* RECEIPT */
    .receipt-screen {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: var(--primary);
      z-index: 600;
      align-items: center;
      justify-content: center;
    }
    .receipt-screen.active { display: flex; }
    .receipt-box {
      background: #fff;
      width: 420px;
      max-width: 95%;
      max-height: 90vh;
      overflow-y: auto;
      border-radius: 20px;
      box-shadow: 0 25px 50px rgba(0,0,0,0.3);
    }
    .receipt-paper { padding: 35px; font-family: 'Courier New', monospace; }
    .receipt-header { text-align: center; margin-bottom: 25px; padding-bottom: 25px; border-bottom: 2px dashed #ddd; }
    .receipt-header .store-logo { margin-bottom: 15px; }
    .receipt-header h2 { font-size: 24px; margin-bottom: 5px; }
    .receipt-header .info { font-size: 12px; color: #666; line-height: 1.6; }
    .receipt-meta { margin-top: 15px; padding-top: 15px; border-top: 1px dashed #ddd; font-size: 12px; }
    .receipt-items { margin-bottom: 20px; }
    .receipt-item { display: flex; justify-content: space-between; padding: 8px 0; font-size: 13px; }
    .receipt-summary { border-top: 2px dashed #ddd; padding-top: 15px; }
    .receipt-row { display: flex; justify-content: space-between; padding: 5px 0; font-size: 14px; }
    .receipt-row.total { font-size: 20px; font-weight: 700; padding-top: 12px; margin-top: 12px; border-top: 2px solid #333; }
    .receipt-footer { text-align: center; margin-top: 25px; padding-top: 20px; border-top: 2px dashed #ddd; font-size: 13px; color: #666; }
    .receipt-actions { padding: 20px; display: flex; gap: 15px; background: #f5f5f5; border-radius: 0 0 20px 20px; }
    .receipt-actions button { flex: 1; }

    /* ADMIN */
    .admin-nav {
      background: var(--secondary);
      padding: 0 30px;
      display: flex;
      gap: 5px;
    }
    .admin-nav button {
      background: transparent;
      border: none;
      color: rgba(255,255,255,0.7);
      padding: 18px 25px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      border-bottom: 3px solid transparent;
      transition: all 0.2s;
    }
    .admin-nav button:hover { color: #fff; background: rgba(255,255,255,0.1); }
    .admin-nav button.active { color: #fff; border-bottom-color: #fff; background: rgba(255,255,255,0.1); }

    .admin-content { padding: 30px; background: #f5f5f5; min-height: calc(100vh - 130px); }
    .admin-title { font-size: 28px; color: var(--primary); margin-bottom: 25px; }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .stat-box {
      background: #fff;
      padding: 28px;
      border-radius: 16px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.05);
    }
    .stat-box .icon { font-size: 28px; margin-bottom: 10px; color: #666; filter: grayscale(100%); }
    .stat-box .value { font-size: 38px; font-weight: 700; color: #222; margin-bottom: 5px; }
    .stat-box .label { font-size: 14px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
    .stat-box.highlight { background: #f5f5f5; border: 2px solid #ddd; }
    .stat-box.highlight .value, .stat-box.highlight .label { color: #222; }

    .data-card {
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.05);
      margin-bottom: 25px;
      overflow: hidden;
    }
    .data-card-header {
      padding: 20px 25px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .data-card-header h3 { font-size: 18px; color: var(--primary); }
    .data-card-body { padding: 0; }

    .data-table { width: 100%; border-collapse: collapse; }
    .data-table th, .data-table td { padding: 16px 20px; text-align: left; border-bottom: 1px solid #f0f0f0; }
    .data-table th { background: #fafafa; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: #888; font-weight: 600; }
    .data-table tr:hover { background: #fafafa; }
    .data-table tr:last-child td { border-bottom: none; }
    
    .badge { display: inline-block; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
    .badge-success { background: #e8f5e9; color: var(--success); }
    .badge-warning { background: #fff8e1; color: var(--warning); }
    .badge-danger { background: #ffebee; color: var(--danger); }

    .stock-bar { height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden; width: 100px; display: inline-block; vertical-align: middle; margin-left: 10px; }
    .stock-bar-fill { height: 100%; background: var(--success); border-radius: 4px; }
    .stock-bar-fill.low { background: var(--warning); }
    .stock-bar-fill.critical { background: var(--danger); }

    /* HELPER CLASSES - replacing inline styles */
    .text-center { text-align: center; }
    .text-muted { color: #888; }
    .mt-sm { margin-top: 8px; }
    .mt-md { margin-top: 15px; }
    .mt-lg { margin-top: 25px; }
    .mb-sm { margin-bottom: 8px; }
    .mb-md { margin-bottom: 12px; }
    .pt-md { padding-top: 20px; }
    .border-top { border-top: 1px solid #eee; }
    .font-small { font-size: 13px; }
    .font-mono { font-family: monospace; }
    .inline-block { display: inline-block; }
    .demo-info { font-size: 13px; }
    .new-customer-text { color: #888; margin-bottom: 12px; }
    .empty-table-cell { text-align: center; color: #888; padding: 40px !important; }
    .text-success { color: var(--success); }
    .store-logo-text { font-size: 32px; font-weight: 700; }
    .receipt-payment-row { margin-top: 12px; }

    /* STOCK UPDATE FORM */
    .stock-update-form {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .stock-input {
      width: 80px;
      padding: 6px 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      text-align: center;
    }
    .stock-input:focus { outline: none; border-color: var(--primary); }
    .btn-stock {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.2s;
    }
    .btn-stock-add { background: var(--success); color: #fff; }
    .btn-stock-add:hover { background: #1e421b; }

    /* REVENUE GRAPH */
    .graph-container {
      padding: 25px;
      background: #fff;
      border-radius: 16px;
      margin-bottom: 25px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.05);
    }
    .graph-title { font-size: 18px; font-weight: 600; color: var(--primary); margin-bottom: 20px; }
    .graph-canvas { width: 100%; height: 250px; position: relative; }
    .graph-bars {
      display: flex;
      align-items: flex-end;
      justify-content: space-around;
      height: 200px;
      padding: 0 20px;
      border-bottom: 2px solid #e0e0e0;
    }
    .graph-bar-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      max-width: 80px;
    }
    .graph-bar {
      width: 40px;
      background: linear-gradient(180deg, var(--primary) 0%, var(--secondary) 100%);
      border-radius: 4px 4px 0 0;
      transition: height 0.5s ease;
      min-height: 4px;
    }
    .graph-bar.positive { background: linear-gradient(180deg, #2d5a27 0%, #1e421b 100%); }
    .graph-bar.negative { background: linear-gradient(180deg, #8b1414 0%, #5a0f0f 100%); }
    .graph-label {
      font-size: 12px;
      color: #666;
      margin-top: 10px;
      text-align: center;
    }
    .graph-value {
      font-size: 11px;
      color: #888;
      margin-bottom: 5px;
      font-weight: 600;
    }
    .graph-legend {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 20px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #666;
    }
    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    .legend-dot.positive { background: #2d5a27; }
    .legend-dot.negative { background: #8b1414; }
    .legend-dot.neutral { background: var(--primary); }

    /* PERFORMANCE SUMMARY */
    .performance-summary {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 25px;
    }
    .perf-card {
      background: #fff;
      padding: 25px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 3px 15px rgba(0,0,0,0.05);
    }
    .perf-card.success { border-left: 4px solid var(--success); }
    .perf-card.warning { border-left: 4px solid var(--warning); }
    .perf-card.danger { border-left: 4px solid var(--danger); }
    .perf-value { font-size: 32px; font-weight: 700; margin-bottom: 5px; }
    .perf-card.success .perf-value { color: var(--success); }
    .perf-card.warning .perf-value { color: var(--warning); }
    .perf-card.danger .perf-value { color: var(--danger); }
    .perf-label { font-size: 14px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
    .perf-trend { font-size: 13px; margin-top: 10px; }
    .trend-up { color: var(--success); }
    .trend-down { color: var(--danger); }

    /* DASHBOARD GRID */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
    }

    .hidden { display: none !important; }
  </style>
</head>
<body>
  <!-- WELCOME SCREEN -->
  <div id="welcomeScreen" class="welcome-screen">
    <!-- Top Navigation -->
    <nav class="welcome-nav">
      <div class="nav-logo" id="welcomeLogo" onclick="handleLogoTap()">
        <div class="logo-icon">
          <span>&#128722;</span>
        </div>
        <h2>Quick<span>Mart</span></h2>
      </div>
      
      <div class="nav-links">
        <a href="#">Home</a>
        <a href="#">Products</a>
        <a href="#">About</a>
        <a href="#">Contact</a>
      </div>
      
      <button class="nav-cart" onclick="startGuest()">
        <span>&#128722;</span>
        Start Shopping
      </button>
    </nav>
    
    <!-- Main Split Content -->
    <div class="welcome-main">
      <!-- Left Side - Content -->
      <div class="welcome-left">
        <div class="welcome-badge">
          <span>&#128640;</span> Now Open for Self-Service
        </div>
        
        <h1 class="welcome-headline">
          Smart <span class="highlight">Self-Checkout</span> Experience
        </h1>
        
        <p class="welcome-desc">
          Experience the perfect blend of speed and convenience. Our self-service kiosks let you scan, pay, and go in seconds - no queues, no waiting!
        </p>
        
        <div class="welcome-options">
          <button class="start-shopping-btn" onclick="startGuest()">
            <span class="icon">&#128722;</span>
            Start Shopping
            <span class="arrow">&#8594;</span>
          </button>
          
          <button class="member-link" onclick="openLoginModal('customer')">
            <span class="icon">&#128100;</span>
            Member Sign In
          </button>
        </div>
        
        <p id="staffHint" class="staff-hint">Tap logo 5 times for staff access</p>
      </div>
      
      <!-- Right Side - Image & Info -->
      <div class="welcome-right">
        <div class="welcome-image">
          <img src="images/simon-kadula--gkndM1GvSA-unsplash%20(1).jpg" alt="Self-Service POS Terminal">
          <div class="image-badge">
            <div class="badge-icon">&#11088;</div>
            <div class="badge-text">Top Rated</div>
          </div>
        </div>
        
        <div class="promo-cards">
          <div class="promo-card">
            <div class="promo-card-content">
              <div class="discount-badge">
                <span class="percent">10%</span>
                <span class="off">OFF</span>
              </div>
              <div>
                <h4>Member Rewards</h4>
                <p>Save 10% on every purchase!</p>
              </div>
            </div>
          </div>
          <div class="promo-card">
            <div class="promo-card-content">
              <img class="promo-card-icon" src="https://img.icons8.com/color/48/bank-card-back-side.png" alt="Payment">
              <div>
                <h4>Pay Your Way</h4>
                <p>Card, Cash, SnapScan & EFT</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Bottom Bar - Contact & Help -->
    <div class="welcome-bottom">
      <div class="contact-info">
        <div class="contact-item">
          <span class="icon">&#128222;</span>
          <a href="tel:+27123456789">+27 12 345 6789</a>
        </div>
        <div class="contact-item">
          <span class="icon">&#128231;</span>
          <a href="mailto:support@quickmart.co.za">support@quickmart.co.za</a>
        </div>
        <div class="contact-item">
          <span class="icon">&#128205;</span>
          <span>123 Market Street, Johannesburg</span>
        </div>
      </div>
      
      <button class="help-btn" onclick="showHelpModal()">
        <span>&#10067;</span>
        Need Help?
      </button>
    </div>
  </div>
  
  <!-- HELP MODAL -->
  <div id="helpModal" class="modal-overlay">
    <span class="modal-close" onclick="closeHelpModal()">&times;</span>
    <div class="modal-box">
      <h2>&#128161; How Can We Help?</h2>
      <div class="help-content">
        <div class="help-item">
          <h4>&#128722; How do I start shopping?</h4>
          <p>Simply tap the green "Start Shopping" button. You can browse products, add them to your cart, and checkout without any account.</p>
        </div>
        <div class="help-item">
          <h4>&#128100; Why should I sign in?</h4>
          <p>Members earn loyalty points on every purchase! Points can be redeemed for discounts. You can also view your purchase history.</p>
        </div>
        <div class="help-item">
          <h4>&#128179; What payment methods are accepted?</h4>
          <p>We accept Cash, Card payments, and Mobile wallets (SnapScan, Zapper). All payments are secure.</p>
        </div>
        <div class="help-item">
          <h4>&#128222; Still need help?</h4>
          <p>Press the assistance button or call <strong>+27 12 345 6789</strong>. Our staff will be with you shortly!</p>
        </div>
      </div>
      <button class="btn btn-primary btn-block help-close-btn" onclick="closeHelpModal()">Got it!</button>
    </div>
  </div>

  <!-- LOGIN MODAL -->
  <div id="loginModal" class="modal-overlay">
    <span class="modal-close" onclick="closeLoginModal()">&times;</span>
    <div class="modal-box">
      <h2 id="loginTitle">Sign In</h2>
      <div id="loginError" class="error-msg hidden"></div>
      <form onsubmit="handleLogin(event)">
        <div class="form-group">
          <label>Username</label>
          <input type="text" id="loginUsername" required placeholder="Enter your username">
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="loginPassword" required placeholder="Enter your password">
        </div>
        <button type="submit" class="btn btn-primary btn-block btn-lg">Sign In</button>
      </form>
      <div id="registerLink" class="mt-lg text-center">
        <p class="new-customer-text">New customer?</p>
        <button class="btn btn-secondary btn-block" onclick="showRegister()">Create Free Account</button>
      </div>
      <div class="mt-lg pt-md border-top demo-info text-muted text-center">
        <strong>Demo Accounts:</strong><br>
        <span class="inline-block mt-sm">Admin: <code>admin</code> / <code>admin123</code></span><br>
        <span>Member: <code>sarah.j</code> / <code>cust123</code></span>
      </div>
    </div>
  </div>

  <!-- REGISTER MODAL -->
  <div id="registerModal" class="modal-overlay">
    <span class="modal-close" onclick="closeRegisterModal()">&times;</span>
    <div class="modal-box">
      <h2>Create Account</h2>
      <div id="registerError" class="error-msg hidden"></div>
      <form onsubmit="handleRegister(event)">
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" id="regName" required placeholder="Enter your full name">
        </div>
        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="regEmail" required placeholder="you@example.com">
        </div>
        <div class="form-group">
          <label>Username</label>
          <input type="text" id="regUsername" required placeholder="Choose a username">
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="regPassword" required placeholder="Choose a secure password">
        </div>
        <div class="form-group">
          <label>Phone Number</label>
          <input type="tel" id="regPhone" placeholder="Optional">
        </div>
        <button type="submit" class="btn btn-primary btn-block btn-lg">Create Account</button>
      </form>
      <button class="btn btn-secondary btn-block mt-md" onclick="backToLogin()">Back to Sign In</button>
    </div>
  </div>

  <!-- KIOSK APP -->
  <div id="kioskApp" class="main-app">
    <header class="header">
      <div class="logo">
        <div class="logo-icon">
          <span>&#128722;</span>
        </div>
        <div class="logo-text">Quick<span>Mart</span></div>
      </div>
      <div class="header-right">
        <div class="header-user">
          <div class="avatar" id="userAvatar">G</div>
          <span id="userDisplay">Guest</span>
        </div>
        <button class="header-btn" onclick="logout()">Exit</button>
      </div>
    </header>

    <div class="kiosk-container">
      <div class="products-section">
        <div class="search-bar">
          <input type="text" id="searchInput" placeholder="Search products by name or scan barcode..." oninput="filterProducts()">
        </div>
        <div class="categories" id="categoriesContainer"></div>
        <div class="products-grid" id="productsGrid"></div>
      </div>

      <div class="cart-section">
        <div class="cart-header">
          <h2>Your Cart <span class="count" id="cartCount">0</span></h2>
        </div>
        <div class="cart-items" id="cartItems">
          <div class="cart-empty">
            <div class="icon">&#128722;</div>
            <p>Your cart is empty</p>
            <p class="font-small mt-sm">Tap products to add them</p>
          </div>
        </div>
        <div class="cart-footer">
          <div class="cart-totals">
            <div class="cart-row"><span>Subtotal:</span><span id="cartSubtotal">R0.00</span></div>
            <div class="cart-row"><span>VAT (15%):</span><span id="cartTax">R0.00</span></div>
            <div class="cart-row total"><span>Total:</span><span id="cartTotal">R0.00</span></div>
          </div>
          <button class="btn btn-primary btn-block btn-lg" id="checkoutBtn" onclick="goToCheckout()" disabled>
            Proceed to Payment
          </button>
          <button class="btn btn-secondary btn-block mt-md" onclick="clearCart()">Clear Cart</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ADMIN APP -->
  <div id="adminApp" class="main-app">
    <header class="header">
      <div class="logo">
        <div class="logo-icon">
          <span>&#128722;</span>
        </div>
        <div class="logo-text">Quick<span>Mart</span> Admin</div>
      </div>
      <div class="header-right">
        <div class="header-user">
          <div class="avatar" id="adminAvatar">A</div>
          <span id="adminUserDisplay">Admin</span>
        </div>
        <button class="header-btn" onclick="logout()">Logout</button>
      </div>
    </header>
    <nav class="admin-nav" id="adminNav">
      <button class="active" onclick="showAdminTab('dashboard', this)">Dashboard</button>
      <button onclick="showAdminTab('sales', this)">Sales History</button>
      <button onclick="showAdminTab('products', this)">Inventory</button>
      <button onclick="showAdminTab('customers', this)">Customers</button>
      <button onclick="showAdminTab('reports', this)">Reports</button>
    </nav>
    <div class="admin-content" id="adminContent"></div>
  </div>

  <!-- CHECKOUT SCREEN -->
  <div id="checkoutScreen" class="checkout-screen">
    <div class="checkout-container">
      <div class="checkout-header">
        <h1>Checkout</h1>
        <p>Review your order and select payment method</p>
      </div>

      <div class="checkout-card">
        <h3>Order Summary</h3>
        <div id="checkoutItems"></div>
        <div class="order-total">
          <span>Total to Pay:</span>
          <span id="checkoutTotal">R0.00</span>
        </div>
      </div>

      <div class="checkout-card">
        <h3>Select Payment Method</h3>
        <div class="payment-methods">
          <div class="payment-method selected" onclick="selectPayment('card', this)">
            <img class="icon" src="https://img.icons8.com/color/96/visa.png" alt="Card">
            <div class="label">Card</div>
          </div>
          <div class="payment-method" onclick="selectPayment('cash', this)">
            <img class="icon" src="https://img.icons8.com/color/96/cash-in-hand.png" alt="Cash">
            <div class="label">Cash</div>
          </div>
          <div class="payment-method" onclick="selectPayment('mobile', this)">
            <img class="icon" src="https://img.icons8.com/color/96/apple-pay.png" alt="Mobile">
            <div class="label">Mobile</div>
          </div>
        </div>
      </div>

      <button class="btn btn-primary btn-block btn-lg" onclick="processPayment()">Complete Payment</button>
      <button class="btn btn-secondary btn-block mt-md" onclick="backToCart()">Back to Cart</button>
    </div>
  </div>

  <!-- RECEIPT SCREEN -->
  <div id="receiptScreen" class="receipt-screen">
    <div class="receipt-box">
      <div class="receipt-paper" id="receiptPaper"></div>
      <div class="receipt-actions">
        <button class="btn btn-secondary" onclick="printReceipt()">Print Receipt</button>
        <button class="btn btn-primary" onclick="finishTransaction()">Done</button>
      </div>
    </div>
  </div>

  <script>
    // ========== STATE ==========
    let currentUser = null;
    let loginMode = 'customer';
    let products = [];
    let customers = [];
    
    // ========== HIDDEN STAFF ACCESS ==========
    let logoTapCount = 0;
    let logoTapTimer = null;
    
    function handleLogoTap() {
      logoTapCount++;
      
      // Show hint after 3 taps
      if (logoTapCount >= 3) {
        document.getElementById('staffHint').classList.add('visible');
      }
      
      // Open staff login after 5 taps
      if (logoTapCount >= 5) {
        logoTapCount = 0;
        document.getElementById('staffHint').classList.remove('visible');
        openLoginModal('admin');
      }
      
      // Reset counter after 2 seconds of no taps
      clearTimeout(logoTapTimer);
      logoTapTimer = setTimeout(() => {
        logoTapCount = 0;
        document.getElementById('staffHint').classList.remove('visible');
      }, 2000);
    }
    
    // Check for staff URL parameter (e.g., ?staff=1)
    if (window.location.search.includes('staff=1')) {
      setTimeout(() => openLoginModal('admin'), 100);
    }
    let sales = [];
    let cart = [];
    let selectedCategory = 'All';
    let selectedPayment = 'card';

    // ========== API ==========
    const api = {
      get: async (url) => {
        try {
          const res = await fetch('/api' + url);
          return await res.json();
        } catch (e) {
          console.error('API Error:', e);
          return [];
        }
      },
      post: async (url, data) => {
        try {
          const res = await fetch('/api' + url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
          return await res.json();
        } catch (e) {
          console.error('API Error:', e);
          return { success: false, error: 'Connection error' };
        }
      }
    };

    // ========== WELCOME ==========
    function startGuest() {
      currentUser = { role: 'guest', name: 'Guest Customer' };
      startKiosk();
    }

    function openLoginModal(mode) {
      loginMode = mode;
      document.getElementById('loginTitle').textContent = mode === 'admin' ? 'Staff Sign In' : 'Member Sign In';
      document.getElementById('registerLink').style.display = mode === 'admin' ? 'none' : 'block';
      document.getElementById('loginModal').classList.add('active');
      document.getElementById('loginError').classList.add('hidden');
    }

    function closeLoginModal() {
      document.getElementById('loginModal').classList.remove('active');
      document.getElementById('loginUsername').value = '';
      document.getElementById('loginPassword').value = '';
    }

    function showHelpModal() {
      document.getElementById('helpModal').classList.add('active');
    }

    function closeHelpModal() {
      document.getElementById('helpModal').classList.remove('active');
    }

    function showRegister() {
      closeLoginModal();
      document.getElementById('registerModal').classList.add('active');
    }

    function closeRegisterModal() {
      document.getElementById('registerModal').classList.remove('active');
    }

    function backToLogin() {
      closeRegisterModal();
      openLoginModal('customer');
    }

    async function handleLogin(e) {
      e.preventDefault();
      const username = document.getElementById('loginUsername').value;
      const password = document.getElementById('loginPassword').value;
      
      console.log('Attempting login:', username);
      
      const result = await api.post('/login', { username, password });
      console.log('Login result:', result);

      if (result.success) {
        currentUser = result.user;
        closeLoginModal();
        if (currentUser.role === 'admin') {
          startAdmin();
        } else {
          startKiosk();
        }
      } else {
        document.getElementById('loginError').textContent = result.error || 'Login failed';
        document.getElementById('loginError').classList.remove('hidden');
      }
    }

    async function handleRegister(e) {
      e.preventDefault();
      const result = await api.post('/register', {
        name: document.getElementById('regName').value,
        email: document.getElementById('regEmail').value,
        username: document.getElementById('regUsername').value,
        password: document.getElementById('regPassword').value,
        phone: document.getElementById('regPhone').value
      });

      if (result.success) {
        currentUser = result.user;
        closeRegisterModal();
        startKiosk();
      } else {
        document.getElementById('registerError').textContent = result.error;
        document.getElementById('registerError').classList.remove('hidden');
      }
    }

    function logout() {
      currentUser = null;
      cart = [];
      document.getElementById('kioskApp').classList.remove('active');
      document.getElementById('adminApp').classList.remove('active');
      document.getElementById('welcomeScreen').style.display = 'flex';
    }

    // ========== KIOSK ==========
    async function startKiosk() {
      document.getElementById('welcomeScreen').style.display = 'none';
      document.getElementById('kioskApp').classList.add('active');
      document.getElementById('userDisplay').textContent = currentUser.name;
      document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
      
      products = await api.get('/products');
      renderCategories();
      renderProducts();
      renderCart();
    }

    function renderCategories() {
      const cats = ['All', ...new Set(products.map(p => p.category))];
      document.getElementById('categoriesContainer').innerHTML = cats.map(c =>
        `<button class="category-btn ${c === selectedCategory ? 'active' : ''}" onclick="selectCategory('${c}')">${c}</button>`
      ).join('');
    }

    function selectCategory(cat) {
      selectedCategory = cat;
      renderCategories();
      renderProducts();
    }

    // Product images mapping by category and name
    function getProductImage(category, name) {
      const images = {
        // Beverages
        'Coca-Cola 500ml': 'https://images.unsplash.com/photo-1629203851122-3726ecdf080e?w=100&h=100&fit=crop',
        'Pepsi 500ml': 'https://images.unsplash.com/photo-1629203851122-3726ecdf080e?w=100&h=100&fit=crop',
        'Spring Water 1L': 'https://images.unsplash.com/photo-1548839140-29a749e1cf4d?w=100&h=100&fit=crop',
        'Orange Juice 1L': 'https://images.unsplash.com/photo-1621506289937-a8e4df240d0b?w=100&h=100&fit=crop',
        'Coffee Latte': 'https://images.unsplash.com/photo-1461023058943-07fcbe16d735?w=100&h=100&fit=crop',
        'Energy Drink': 'https://images.unsplash.com/photo-1527960471264-932f39eb5846?w=100&h=100&fit=crop',
        // Snacks
        'Lays Chips Original': 'https://images.unsplash.com/photo-1566478989037-eec170784d0b?w=100&h=100&fit=crop',
        'Doritos Nacho': 'https://images.unsplash.com/photo-1600952841320-db92ec4047ca?w=100&h=100&fit=crop',
        'Peanuts Salted': 'https://images.unsplash.com/photo-1567892737950-30c4db37cd89?w=100&h=100&fit=crop',
        'Chocolate Bar': 'https://images.unsplash.com/photo-1606312619070-d48b4c652a52?w=100&h=100&fit=crop',
        'Gummy Bears': 'https://images.unsplash.com/photo-1582058091505-f87a2e55a40f?w=100&h=100&fit=crop',
        // Bakery
        'Fresh Croissant': 'https://images.unsplash.com/photo-1555507036-ab1f4038808a?w=100&h=100&fit=crop',
        'Muffin Blueberry': 'https://images.unsplash.com/photo-1607958996333-41aef7caefaa?w=100&h=100&fit=crop',
        'Baguette': 'https://images.unsplash.com/photo-1549931319-a545dcf3bc73?w=100&h=100&fit=crop',
        // Dairy
        'Whole Milk 1L': 'https://images.unsplash.com/photo-1563636619-e9143da7973b?w=100&h=100&fit=crop',
        'Greek Yogurt': 'https://images.unsplash.com/photo-1488477181946-6428a0291777?w=100&h=100&fit=crop',
        'Cheddar Cheese 200g': 'https://images.unsplash.com/photo-1618164436241-4473940d1f5c?w=100&h=100&fit=crop',
        'Butter 250g': 'https://images.unsplash.com/photo-1589985270826-4b7bb135bc9d?w=100&h=100&fit=crop',
        // Fresh Food
        'Fresh Salad': 'https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=100&h=100&fit=crop',
        'Sandwich Ham & Cheese': 'https://images.unsplash.com/photo-1528735602780-2552fd46c7af?w=100&h=100&fit=crop',
        'Fruit Cup': 'https://images.unsplash.com/photo-1490474418585-ba9bad8fd0ea?w=100&h=100&fit=crop',
        'Sushi Box': 'https://images.unsplash.com/photo-1579871494447-9811cf80d66c?w=100&h=100&fit=crop',
        // Household
        'Paper Towels': 'https://images.unsplash.com/photo-1583847268964-b28dc8f51f92?w=100&h=100&fit=crop',
        'Hand Soap': 'https://images.unsplash.com/photo-1584305574647-0cc949a2bb9f?w=100&h=100&fit=crop',
      };
      
      // Return specific image or category default
      if (images[name]) return images[name];
      
      const categoryDefaults = {
        'Beverages': 'https://images.unsplash.com/photo-1544145945-f90425340c7e?w=100&h=100&fit=crop',
        'Snacks': 'https://images.unsplash.com/photo-1621939514649-280e2ee25f60?w=100&h=100&fit=crop',
        'Dairy': 'https://images.unsplash.com/photo-1628088062854-d1870b4553da?w=100&h=100&fit=crop',
        'Bakery': 'https://images.unsplash.com/photo-1509440159596-0249088772ff?w=100&h=100&fit=crop',
        'Fresh Food': 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=100&h=100&fit=crop',
        'Household': 'https://images.unsplash.com/photo-1563453392212-326f5e854473?w=100&h=100&fit=crop',
      };
      
      return categoryDefaults[category] || 'https://images.unsplash.com/photo-1604719312566-8912e9227c6a?w=100&h=100&fit=crop';
    }

    function renderProducts() {
      const search = document.getElementById('searchInput')?.value.toLowerCase() || '';
      const filtered = products.filter(p => {
        const matchCat = selectedCategory === 'All' || p.category === selectedCategory;
        const matchSearch = p.name.toLowerCase().includes(search) || (p.barcode && p.barcode.includes(search));
        return matchCat && matchSearch;
      });

      document.getElementById('productsGrid').innerHTML = filtered.map(p => {
        const imgUrl = getProductImage(p.category, p.name);
        return `
        <div class="product-card ${p.stock <= 0 ? 'out' : ''}" onclick="addToCart(${p.id})">
          <img class="product-img" src="${imgUrl}" alt="${p.name}" onerror="this.src='https://via.placeholder.com/80x80?text=${encodeURIComponent(p.name.substring(0,8))}'">
          <div class="tag">${p.category}</div>
          <div class="name">${p.name}</div>
          <div class="price">R${p.price.toFixed(2)}</div>
          <div class="stock">${p.stock > 0 ? p.stock + ' available' : 'Out of stock'}</div>
        </div>
      `}).join('');
    }

    function filterProducts() { renderProducts(); }

    function addToCart(productId) {
      const product = products.find(p => p.id === productId);
      if (!product || product.stock <= 0) return;

      const existing = cart.find(c => c.productId === productId);
      if (existing) {
        if (existing.quantity >= product.stock) { alert('Maximum stock reached'); return; }
        existing.quantity++;
      } else {
        cart.push({ productId, name: product.name, price: product.price, quantity: 1, maxStock: product.stock });
      }
      renderCart();
    }

    function updateQty(productId, delta) {
      const item = cart.find(c => c.productId === productId);
      if (!item) return;

      item.quantity += delta;
      if (item.quantity <= 0) cart = cart.filter(c => c.productId !== productId);
      else if (item.quantity > item.maxStock) item.quantity = item.maxStock;
      renderCart();
    }

    function removeItem(productId) {
      cart = cart.filter(c => c.productId !== productId);
      renderCart();
    }

    function clearCart() {
      cart = [];
      renderCart();
    }

    function renderCart() {
      const container = document.getElementById('cartItems');
      document.getElementById('cartCount').textContent = cart.reduce((sum, c) => sum + c.quantity, 0);
      
      if (cart.length === 0) {
        container.innerHTML = `<div class="cart-empty"><div class="icon">&#128722;</div><p>Your cart is empty</p><p class="font-small mt-sm">Tap products to add them</p></div>`;
        document.getElementById('cartSubtotal').textContent = 'R0.00';
        document.getElementById('cartTax').textContent = 'R0.00';
        document.getElementById('cartTotal').textContent = 'R0.00';
        document.getElementById('checkoutBtn').disabled = true;
        return;
      }

      container.innerHTML = cart.map(item => `
        <div class="cart-item">
          <div class="cart-item-info">
            <div class="cart-item-name">${item.name}</div>
            <div class="cart-item-price">R${item.price.toFixed(2)} each</div>
          </div>
          <div class="cart-item-qty">
            <button class="qty-btn" onclick="updateQty(${item.productId}, -1)">-</button>
            <span class="qty-value">${item.quantity}</span>
            <button class="qty-btn" onclick="updateQty(${item.productId}, 1)">+</button>
          </div>
          <div class="cart-item-subtotal">R${(item.price * item.quantity).toFixed(2)}</div>
          <button class="cart-item-remove" onclick="removeItem(${item.productId})">&times;</button>
        </div>
      `).join('');

      const subtotal = cart.reduce((sum, i) => sum + i.price * i.quantity, 0);
      const tax = subtotal * 0.15;
      const total = subtotal + tax;

      document.getElementById('cartSubtotal').textContent = 'R' + subtotal.toFixed(2);
      document.getElementById('cartTax').textContent = 'R' + tax.toFixed(2);
      document.getElementById('cartTotal').textContent = 'R' + total.toFixed(2);
      document.getElementById('checkoutBtn').disabled = false;
    }

    // ========== CHECKOUT ==========
    function goToCheckout() {
      if (cart.length === 0) return;

      document.getElementById('checkoutItems').innerHTML = cart.map(item => `
        <div class="order-item">
          <span>${item.quantity} x ${item.name}</span>
          <span>R${(item.price * item.quantity).toFixed(2)}</span>
        </div>
      `).join('');

      const total = cart.reduce((sum, i) => sum + i.price * i.quantity, 0) * 1.15;
      document.getElementById('checkoutTotal').textContent = 'R' + total.toFixed(2);
      document.getElementById('checkoutScreen').classList.add('active');
    }

    function backToCart() {
      document.getElementById('checkoutScreen').classList.remove('active');
    }

    function selectPayment(method, el) {
      selectedPayment = method;
      document.querySelectorAll('.payment-method').forEach(p => p.classList.remove('selected'));
      el.classList.add('selected');
    }

    async function processPayment() {
      const sale = await api.post('/sales', {
        items: cart.map(c => ({ productId: c.productId, quantity: c.quantity })),
        customerId: currentUser.customerId || null,
        paymentMethod: selectedPayment,
        isKiosk: true
      });

      document.getElementById('checkoutScreen').classList.remove('active');
      showReceipt(sale);
    }

    function showReceipt(sale) {
      document.getElementById('receiptPaper').innerHTML = `
        <div class="receipt-header">
          <div class="store-logo store-logo-text">QuickMart</div>
          <div class="info">
            Self-Service POS<br>
            123 Main Street, Johannesburg<br>
            Tel: 011-555-1234 | VAT: 4850123456
          </div>
          <div class="receipt-meta">
            <div><strong>Receipt:</strong> ${sale.receiptNumber}</div>
            <div>${new Date(sale.timestamp).toLocaleString()}</div>
          </div>
        </div>
        <div class="receipt-items">
          ${sale.items.map(i => `
            <div class="receipt-item">
              <span>${i.quantity} x ${i.name}</span>
              <span>R${i.subtotal.toFixed(2)}</span>
            </div>
          `).join('')}
        </div>
        <div class="receipt-summary">
          <div class="receipt-row"><span>Subtotal:</span><span>R${sale.subtotal.toFixed(2)}</span></div>
          <div class="receipt-row"><span>VAT (15%):</span><span>R${sale.tax.toFixed(2)}</span></div>
          <div class="receipt-row total"><span>TOTAL:</span><span>R${sale.total.toFixed(2)}</span></div>
          <div class="receipt-row receipt-payment-row"><span>Payment:</span><span>${sale.paymentMethod.toUpperCase()}</span></div>
        </div>
        <div class="receipt-footer">
          <strong>Customer: ${sale.customerName}</strong><br><br>
          Thank you for shopping with QuickMart!<br>
          Visit us again soon.
        </div>
      `;
      document.getElementById('receiptScreen').classList.add('active');
    }

    function printReceipt() { window.print(); }

    async function finishTransaction() {
      document.getElementById('receiptScreen').classList.remove('active');
      cart = [];
      renderCart();
      products = await api.get('/products');
      renderProducts();
    }

    // ========== ADMIN ==========
    async function startAdmin() {
      document.getElementById('welcomeScreen').style.display = 'none';
      document.getElementById('adminApp').classList.add('active');
      document.getElementById('adminUserDisplay').textContent = currentUser.name;
      document.getElementById('adminAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
      
      products = await api.get('/products');
      customers = await api.get('/customers');
      sales = await api.get('/sales');
      
      showAdminTab('dashboard', document.querySelector('#adminNav button'));
    }

    async function showAdminTab(tab, btn) {
      document.querySelectorAll('#adminNav button').forEach(b => b.classList.remove('active'));
      if (btn) btn.classList.add('active');

      const content = document.getElementById('adminContent');

      if (tab === 'dashboard') {
        const stats = await api.get('/stats');
        const trend = await api.get('/stats/trend');
        const lowStock = products.filter(p => p.stock < 20);
        const recentSales = sales.slice(-5).reverse();
        const maxRevenue = Math.max(...trend.days.map(d => d.revenue), 1);
        
        content.innerHTML = `
          <h2 class="admin-title">Store Dashboard</h2>
          
          <!-- Performance Summary -->
          <div class="performance-summary">
            <div class="perf-card ${parseFloat(trend.summary.trendPercent) >= 0 ? 'success' : 'danger'}">
              <div class="perf-value">R${stats.todaySales}</div>
              <div class="perf-label">Today's Revenue</div>
              <div class="perf-trend ${parseFloat(trend.summary.trendPercent) >= 0 ? 'trend-up' : 'trend-down'}">
                ${parseFloat(trend.summary.trendPercent) >= 0 ? '+' : ''}${trend.summary.trendPercent}% vs yesterday
              </div>
            </div>
            <div class="perf-card success">
              <div class="perf-value">R${trend.summary.totalRevenue}</div>
              <div class="perf-label">7-Day Revenue</div>
              <div class="perf-trend">Avg: R${trend.summary.avgDaily}/day</div>
            </div>
            <div class="perf-card ${stats.lowStockItems > 3 ? 'warning' : 'success'}">
              <div class="perf-value">${stats.totalProducts}</div>
              <div class="perf-label">Products</div>
              <div class="perf-trend ${stats.lowStockItems > 0 ? 'trend-down' : ''}">${stats.lowStockItems} items low stock</div>
            </div>
          </div>

          <!-- Revenue Graph -->
          <div class="graph-container">
            <div class="graph-title">7-Day Revenue Trend</div>
            <div class="graph-bars">
              ${trend.days.map(d => {
                const height = maxRevenue > 0 ? Math.max(4, (d.revenue / maxRevenue) * 180) : 4;
                const barClass = d.revenue > parseFloat(trend.summary.avgDaily) ? 'positive' : d.revenue > 0 ? '' : 'negative';
                return `
                  <div class="graph-bar-wrapper">
                    <div class="graph-value">R${d.revenue.toFixed(0)}</div>
                    <div class="graph-bar ${barClass}" style="height: ${height}px"></div>
                    <div class="graph-label">${d.day}<br>${d.date}</div>
                  </div>
                `;
              }).join('')}
            </div>
            <div class="graph-legend">
              <div class="legend-item"><div class="legend-dot positive"></div>Above Average</div>
              <div class="legend-item"><div class="legend-dot neutral"></div>Below Average</div>
              <div class="legend-item"><div class="legend-dot negative"></div>No Sales</div>
            </div>
          </div>
          
          <div class="stats-grid">
            <div class="stat-box">
              <div class="value">${stats.todayTransactions}</div>
              <div class="label">Transactions Today</div>
            </div>
            <div class="stat-box">
              <div class="value">${stats.totalCustomers}</div>
              <div class="label">Registered Customers</div>
            </div>
          </div>
          
          <div class="dashboard-grid">
            <div class="data-card">
              <div class="data-card-header"><h3>Recent Sales</h3></div>
              <div class="data-card-body">
                <table class="data-table">
                  <thead><tr><th>Receipt</th><th>Customer</th><th>Amount</th></tr></thead>
                  <tbody>
                    ${recentSales.map(s => `
                      <tr>
                        <td><strong>${s.receiptNumber}</strong></td>
                        <td>${s.customerName}</td>
                        <td><strong>R${s.total.toFixed(2)}</strong></td>
                      </tr>
                    `).join('') || '<tr><td colspan="3" class="empty-table-cell">No sales yet today</td></tr>'}
                  </tbody>
                </table>
              </div>
            </div>
            
            <div class="data-card">
              <div class="data-card-header"><h3>Low Stock Items</h3></div>
              <div class="data-card-body">
                <table class="data-table">
                  <thead><tr><th>Product</th><th>Stock Level</th></tr></thead>
                  <tbody>
                    ${lowStock.slice(0, 5).map(p => {
                      const pct = Math.min(100, (p.stock / 50) * 100);
                      const cls = p.stock < 10 ? 'critical' : p.stock < 20 ? 'low' : '';
                      return `
                        <tr>
                          <td>${p.name}</td>
                          <td>
                            <span class="badge ${p.stock < 10 ? 'badge-danger' : 'badge-warning'}">${p.stock} units</span>
                            <div class="stock-bar"><div class="stock-bar-fill ${cls}" style="width: ${pct}%"></div></div>
                          </td>
                        </tr>
                      `;
                    }).join('') || '<tr><td colspan="2" class="empty-table-cell">All items well stocked</td></tr>'}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        `;
      } else if (tab === 'sales') {
        sales = await api.get('/sales');
        content.innerHTML = `
          <h2 class="admin-title">Sales History</h2>
          <div class="data-card">
            <div class="data-card-header">
              <h3>All Transactions</h3>
              <span class="text-muted">${sales.length} total sales</span>
            </div>
            <div class="data-card-body">
              <table class="data-table">
                <thead>
                  <tr><th>Receipt #</th><th>Customer</th><th>Items</th><th>Subtotal</th><th>VAT</th><th>Total</th><th>Payment</th><th>Date</th></tr>
                </thead>
                <tbody>
                  ${sales.slice().reverse().map(s => `
                    <tr>
                      <td><strong>${s.receiptNumber}</strong></td>
                      <td>${s.customerName}</td>
                      <td>${s.items.length} items</td>
                      <td>R${s.subtotal.toFixed(2)}</td>
                      <td>R${s.tax.toFixed(2)}</td>
                      <td><strong class="text-success">R${s.total.toFixed(2)}</strong></td>
                      <td><span class="badge badge-success">${s.paymentMethod.toUpperCase()}</span></td>
                      <td>${new Date(s.timestamp).toLocaleString()}</td>
                    </tr>
                  `).join('') || '<tr><td colspan="8" class="empty-table-cell">No sales recorded yet</td></tr>'}
                </tbody>
              </table>
            </div>
          </div>
        `;
      } else if (tab === 'products') {
        products = await api.get('/products');
        content.innerHTML = `
          <h2 class="admin-title">Product Inventory</h2>
          <div class="data-card">
            <div class="data-card-header">
              <h3>All Products</h3>
              <span class="text-muted">${products.length} products</span>
            </div>
            <div class="data-card-body">
              <table class="data-table">
                <thead>
                  <tr><th>Product Name</th><th>Category</th><th>Price</th><th>Stock</th><th>Status</th><th>Add Stock</th><th>Barcode</th></tr>
                </thead>
                <tbody>
                  ${products.map(p => {
                    const status = p.stock === 0 ? 'Out of Stock' : p.stock < 10 ? 'Critical' : p.stock < 20 ? 'Low Stock' : 'In Stock';
                    const badge = p.stock === 0 ? 'badge-danger' : p.stock < 10 ? 'badge-danger' : p.stock < 20 ? 'badge-warning' : 'badge-success';
                    return `
                      <tr>
                        <td><strong>${p.name}</strong></td>
                        <td>${p.category}</td>
                        <td>R${p.price.toFixed(2)}</td>
                        <td><span id="stock-${p.id}">${p.stock}</span> units</td>
                        <td><span class="badge ${badge}" id="status-${p.id}">${status}</span></td>
                        <td>
                          <div class="stock-update-form">
                            <input type="number" class="stock-input" id="qty-${p.id}" value="10" min="1" max="999">
                            <button class="btn-stock btn-stock-add" onclick="addStock(${p.id})">Add</button>
                          </div>
                        </td>
                        <td class="font-mono text-muted">${p.barcode || '-'}</td>
                      </tr>
                    `;
                  }).join('')}
                </tbody>
              </table>
            </div>
          </div>
        `;
      } else if (tab === 'customers') {
        customers = await api.get('/customers');
        content.innerHTML = `
          <h2 class="admin-title">Customer Management</h2>
          <div class="data-card">
            <div class="data-card-header">
              <h3>Registered Customers</h3>
              <span class="text-muted">${customers.length} members</span>
            </div>
            <div class="data-card-body">
              <table class="data-table">
                <thead>
                  <tr><th>Customer Name</th><th>Email</th><th>Phone</th><th>Loyalty Points</th><th>Member Since</th></tr>
                </thead>
                <tbody>
                  ${customers.map(c => `
                    <tr>
                      <td><strong>${c.name}</strong></td>
                      <td>${c.email}</td>
                      <td>${c.phone}</td>
                      <td><span class="badge badge-success">${c.loyaltyPoints} pts</span></td>
                      <td>${c.memberSince}</td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>
          </div>
        `;
      } else if (tab === 'reports') {
        const totalRevenue = sales.reduce((sum, s) => sum + s.total, 0);
        const avgSale = sales.length > 0 ? totalRevenue / sales.length : 0;
        const topProducts = {};
        sales.forEach(s => s.items.forEach(i => {
          topProducts[i.name] = (topProducts[i.name] || 0) + i.quantity;
        }));
        const sortedProducts = Object.entries(topProducts).sort((a, b) => b[1] - a[1]).slice(0, 5);
        
        content.innerHTML = `
          <h2 class="admin-title">Sales Reports</h2>
          <div class="stats-grid">
            <div class="stat-box">
              <div class="value">R${totalRevenue.toFixed(2)}</div>
              <div class="label">Total Revenue</div>
            </div>
            <div class="stat-box">
              <div class="value">${sales.length}</div>
              <div class="label">Total Transactions</div>
            </div>
            <div class="stat-box">
              <div class="value">R${avgSale.toFixed(2)}</div>
              <div class="label">Average Sale Value</div>
            </div>
          </div>
          
          <div class="data-card">
            <div class="data-card-header"><h3>Top Selling Products</h3></div>
            <div class="data-card-body">
              <table class="data-table">
                <thead><tr><th>Rank</th><th>Product</th><th>Units Sold</th></tr></thead>
                <tbody>
                  ${sortedProducts.map((p, i) => `
                    <tr>
                      <td><strong>#${i + 1}</strong></td>
                      <td>${p[0]}</td>
                      <td><span class="badge badge-success">${p[1]} units</span></td>
                    </tr>
                  `).join('') || '<tr><td colspan="3" class="empty-table-cell">No sales data yet</td></tr>'}
                </tbody>
              </table>
            </div>
          </div>
        `;
      }
    }

    // ========== STOCK MANAGEMENT ==========
    async function addStock(productId) {
      const qtyInput = document.getElementById(`qty-${productId}`);
      const quantity = parseInt(qtyInput.value) || 10;
      
      const result = await api.put(`/products/${productId}/stock`, { quantity });
      
      if (result.success) {
        // Update the UI
        const product = result.product;
        document.getElementById(`stock-${productId}`).textContent = product.stock;
        
        // Update status badge
        const status = product.stock === 0 ? 'Out of Stock' : product.stock < 10 ? 'Critical' : product.stock < 20 ? 'Low Stock' : 'In Stock';
        const badge = product.stock === 0 ? 'badge-danger' : product.stock < 10 ? 'badge-danger' : product.stock < 20 ? 'badge-warning' : 'badge-success';
        const statusEl = document.getElementById(`status-${productId}`);
        statusEl.textContent = status;
        statusEl.className = `badge ${badge}`;
        
        // Update local products array
        const idx = products.findIndex(p => p.id === productId);
        if (idx !== -1) products[idx].stock = product.stock;
        
        // Flash success
        qtyInput.style.borderColor = '#2d5a27';
        setTimeout(() => qtyInput.style.borderColor = '', 1000);
      }
    }

    // Add PUT method support to api
    api.put = async (url, data) => {
      try {
        const res = await fetch('/api' + url, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
        return await res.json();
      } catch (e) {
        console.error('API Error:', e);
        return { success: false, error: 'Connection error' };
      }
    };
  </script>
</body>
</html>